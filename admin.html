<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - SuperMercado Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, where, orderBy, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyATeWSJX1mSsITEugABJFVKefWbCIuyJPM",
            authDomain: "gestaomercado-001.firebaseapp.com",
            projectId: "gestaomercado-001",
            storageBucket: "gestaomercado-001.firebasestorage.app",
            messagingSenderId: "541484410097",
            appId: "1:541484410097:web:77108a82e7273a96373550",
            measurementId: "G-TQ37LCWYKX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Exportar para uso global
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseAddDoc = addDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseOrderBy = orderBy;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        
        console.log("Firebase Admin inicializado com sucesso!");
        
        // Verificar autenticação
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'login.html?redirect=admin';
            } else {
                console.log("Admin logado:", user.email);
                
                // Carregar dados do usuário
                try {
                    const userDoc = await getDoc(doc(db, "usuarios", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        window.currentUser = {
                            uid: user.uid,
                            email: user.email,
                            ...userData
                        };
                        
                        // Atualizar interface
                        if (document.getElementById('userAvatar')) {
                            const avatar = document.getElementById('userAvatar');
                            const userName = document.getElementById('userName');
                            const userEmail = document.getElementById('userEmail');
                            
                            if (userData.nome) {
                                avatar.textContent = userData.nome.charAt(0).toUpperCase();
                                userName.textContent = userData.nome;
                            } else {
                                avatar.textContent = user.email.charAt(0).toUpperCase();
                                userName.textContent = user.email.split('@')[0];
                            }
                            userEmail.textContent = user.email;
                        }
                    }
                } catch (error) {
                    console.error("Erro ao carregar dados do usuário:", error);
                }
                
                // Inicializar sistema
                if (typeof initSistema === 'function') {
                    initSistema();
                }
            }
        });
        
        // Função de logout global
        window.adminLogout = async function() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
                alert('Erro ao fazer logout: ' + error.message);
            }
        };
    </script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #9b59b6;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --sidebar-bg: #1a252f;
            --sidebar-hover: #2c3e50;
            --light-bg: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== LAYOUT GERAL ========== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .logo i {
            color: var(--secondary);
            font-size: 1.8rem;
        }

        .logo-text {
            color: white;
            font-weight: 800;
            font-size: 1.3rem;
        }

        .store-info {
            text-align: center;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
        }

        .store-name {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section-title {
            padding: 10px 25px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.5);
            font-weight: 600;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--secondary);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1.2rem;
        }

        .nav-link span {
            font-weight: 500;
            flex: 1;
        }

        .nav-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: auto;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--sidebar-bg);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .user-details {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.3);
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            background: #f5f7fa;
            transition: margin-left 0.3s ease;
        }

        .main-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e6ed;
            position: sticky;
            top: 0;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            padding: 5px;
        }

        .header-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .current-datetime {
            color: var(--gray);
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #8e44ad);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-xs {
            padding: 5px 10px;
            font-size: 0.75rem;
        }

        .btn-icon {
            padding: 10px;
            width: 40px;
            height: 40px;
            justify-content: center;
        }

        /* ========== CONTENT SECTIONS ========== */
        .content-wrapper {
            padding: 30px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== CARDS ========== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid #e0e6ed;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-bg);
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* ========== FORMS ========== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-control:disabled {
            background: var(--light-bg);
            cursor: not-allowed;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
            display: block;
        }

        /* ========== TABLES ========== */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e0e6ed;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 800px;
        }

        .table th {
            background: #f8fafc;
            padding: 15px 20px;
            text-align: left;
            font-weight: 700;
            color: var(--primary);
            border-bottom: 2px solid #e0e6ed;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e6ed;
            vertical-align: middle;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .table-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .table-empty {
            text-align: center;
            padding: 50px !important;
            color: var(--gray);
        }

        .table-empty i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* ========== BADGES ========== */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(155, 89, 182, 0.1);
            color: var(--info);
        }

        .badge-primary {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }

        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-bg);
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px;
            line-height: 1;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* ========== CAIXA / PDV ========== */
        .caixa-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 12px;
        }

        .produto-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
        }

        .produto-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .produto-item.sem-estoque {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .produto-item.sem-estoque:hover {
            transform: none;
            border-color: transparent;
        }

        .produto-nome {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 1rem;
            line-height: 1.3;
            flex: 1;
        }

        .produto-preco {
            color: var(--success);
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .produto-estoque {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .produto-codigo {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .produto-estoque-baixo {
            color: var(--warning);
            font-weight: 600;
        }

        .produto-sem-estoque {
            color: var(--danger);
            font-weight: 600;
        }

        .carrinho-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 100px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .carrinho-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-bg);
        }

        .carrinho-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e6ed;
        }

        .carrinho-item-info {
            flex: 1;
            min-width: 0;
        }

        .carrinho-item-nome {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .carrinho-item-preco {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .carrinho-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .carrinho-item-quantidade {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--light-bg);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .carrinho-item-quantidade button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary);
            font-size: 1rem;
            padding: 2px 8px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .carrinho-item-quantidade button:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .carrinho-total {
            padding: 25px 0;
            border-top: 3px solid #e0e6ed;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .total-grande {
            font-size: 2rem;
            font-weight: 800;
            color: var(--success);
        }

        /* ========== PAGAMENTO ========== */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .payment-method {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .payment-method:hover {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.05);
        }

        .payment-method.active {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }

        .payment-method i {
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 8px;
        }

        .payment-method span {
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* ========== RESPONSIVO ========== */
        @media (max-width: 1200px) {
            .caixa-container {
                grid-template-columns: 1fr;
            }
            
            .carrinho-container {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header-actions {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .produtos-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .modal-content {
                padding: 25px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .payment-methods {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ========== LOADING ========== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== SEARCH ========== */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border-left-color: var(--success);
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border-left-color: var(--danger);
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border-left-color: var(--warning);
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            border-left-color: var(--secondary);
        }

        /* ========== TABS ========== */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e6ed;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }

        .tab.active {
            color: var(--secondary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--secondary);
        }

        /* ========== COMPROVANTE ========== */
        .comprovante-preview {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
        }

        .comprovante-header {
            text-align: center;
            border-bottom: 2px dashed #e0e6ed;
            padding-bottom: 20px;
            margin-bottom: 25px;
        }

        .comprovante-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .comprovante-items {
            margin-bottom: 25px;
        }

        .comprovante-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f3f8;
            font-size: 0.9rem;
        }

        .comprovante-item-desc {
            flex: 1;
        }

        .comprovante-item-qtd {
            margin-right: 10px;
            color: var(--gray);
        }

        .comprovante-total {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            border-top: 2px solid #e0e6ed;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--primary);
        }

        /* ========== CHART CONTAINER ========== */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: 400px;
            position: relative;
        }

        /* ========== PAGINATION ========== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 8px 15px;
            border: 1px solid #e0e6ed;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--light-bg);
            border-color: var(--secondary);
        }

        .page-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ========== FILTERS ========== */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ========== TOOLTIPS ========== */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        /* ========== NOTIFICATIONS ========== */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Modais -->
    <div class="modal" id="modalProduto">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-box"></i>
                    <span id="modalProdutoTitulo">Novo Produto</span>
                </h3>
                <button class="close-modal" onclick="fecharModal('modalProduto')">&times;</button>
            </div>
            <form id="formProduto">
                <input type="hidden" id="produtoId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Código do Produto *</label>
                        <input type="text" id="produtoCodigo" class="form-control" required placeholder="Ex: PROD001 ou 7891234567890">
                        <span class="form-help">Código interno ou código de barras</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome do Produto *</label>
                        <input type="text" id="produtoNome" class="form-control" required placeholder="Ex: Arroz Integral 5kg">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select id="produtoCategoria" class="form-control" required>
                            <option value="">Selecione uma categoria</option>
                            <option value="alimentos">Alimentos</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="limpeza">Limpeza</option>
                            <option value="higiene">Higiene Pessoal</option>
                            <option value="hortifruti">Hortifruti</option>
                            <option value="acougue">Açougue</option>
                            <option value="padaria">Padaria</option>
                            <option value="laticinios">Laticínios</option>
                            <option value="congelados">Congelados</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unidade de Medida</label>
                        <select id="produtoUnidade" class="form-control">
                            <option value="un">Unidade (UN)</option>
                            <option value="kg">Quilograma (KG)</option>
                            <option value="g">Grama (G)</option>
                            <option value="l">Litro (L)</option>
                            <option value="ml">Mililitro (ML)</option>
                            <option value="cx">Caixa (CX)</option>
                            <option value="pc">Pacote (PC)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Preço de Custo (R$) *</label>
                        <input type="number" id="produtoPrecoCusto" class="form-control" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preço de Venda (R$) *</label>
                        <input type="number" id="produtoPrecoVenda" class="form-control" step="0.01" min="0" required placeholder="0.00">
                        <span class="form-help" id="margemLucro">Margem de lucro: 0%</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Estoque Atual *</label>
                        <input type="number" id="produtoEstoque" class="form-control" min="0" required value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estoque Mínimo *</label>
                        <input type="number" id="produtoEstoqueMinimo" class="form-control" min="0" required value="5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fornecedor</label>
                        <input type="text" id="produtoFornecedor" class="form-control" placeholder="Nome do fornecedor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Localização (Prateleira)</label>
                        <input type="text" id="produtoLocalizacao" class="form-control" placeholder="Ex: Corredor 3, Prateleira B">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <textarea id="produtoDescricao" class="form-control" rows="3" placeholder="Descrição detalhada do produto"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Imagem (URL)</label>
                    <input type="url" id="produtoImagem" class="form-control" placeholder="https://exemplo.com/imagem.jpg">
                    <span class="form-help">Insira a URL de uma imagem do produto</span>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="produtoControlarValidade"> Controlar Validade
                    </label>
                </div>
                <div id="validadeContainer" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Validade</label>
                            <input type="date" id="produtoValidade" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dias para Alerta</label>
                            <input type="number" id="produtoDiasAlerta" class="form-control" min="1" value="30">
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarProduto">
                        <i class="fas fa-save"></i> Salvar Produto
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalProduto')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalCliente">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user"></i>
                    <span id="modalClienteTitulo">Novo Cliente</span>
                </h3>
                <button class="close-modal" onclick="fecharModal('modalCliente')">&times;</button>
            </div>
            <form id="formCliente">
                <input type="hidden" id="clienteId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" id="clienteNome" class="form-control" required placeholder="Ex: João da Silva">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF *</label>
                        <input type="text" id="clienteCPF" class="form-control" required placeholder="000.000.000-00" oninput="formatarCPF(this)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone *</label>
                        <input type="text" id="clienteTelefone" class="form-control" required placeholder="(11) 99999-9999" oninput="formatarTelefone(this)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="clienteEmail" class="form-control" placeholder="cliente@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endereço Completo</label>
                    <textarea id="clienteEndereco" class="form-control" rows="2" placeholder="Rua, número, bairro, cidade, estado"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" id="clienteNascimento" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Cliente</label>
                        <select id="clienteTipo" class="form-control">
                            <option value="normal">Normal</option>
                            <option value="vip">VIP</option>
                            <option value="fidelizado">Fidelizado</option>
                            <option value="corporativo">Corporativo</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea id="clienteObservacoes" class="form-control" rows="2" placeholder="Observações sobre o cliente"></textarea>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarCliente">
                        <i class="fas fa-save"></i> Salvar Cliente
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalCliente')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalFuncionario">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-tie"></i>
                    <span id="modalFuncionarioTitulo">Novo Funcionário</span>
                </h3>
                <button class="close-modal" onclick="fecharModal('modalFuncionario')">&times;</button>
            </div>
            <form id="formFuncionario">
                <input type="hidden" id="funcionarioId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" id="funcionarioNome" class="form-control" required placeholder="Ex: Maria Santos">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF *</label>
                        <input type="text" id="funcionarioCPF" class="form-control" required placeholder="000.000.000-00" oninput="formatarCPF(this)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Cargo *</label>
                        <select id="funcionarioCargo" class="form-control" required>
                            <option value="">Selecione um cargo</option>
                            <option value="caixa">Caixa</option>
                            <option value="gerente">Gerente</option>
                            <option value="supervisor">Supervisor</option>
                            <option value="estoque">Estoquista</option>
                            <option value="repositor">Repositor</option>
                            <option value="atendente">Atendente</option>
                            <option value="administrativo">Administrativo</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Salário (R$)</label>
                        <input type="number" id="funcionarioSalario" class="form-control" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone *</label>
                        <input type="text" id="funcionarioTelefone" class="form-control" required placeholder="(11) 99999-9999" oninput="formatarTelefone(this)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="funcionarioEmail" class="form-control" placeholder="funcionario@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endereço Completo</label>
                    <textarea id="funcionarioEndereco" class="form-control" rows="2" placeholder="Endereço completo"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Admissão *</label>
                        <input type="date" id="funcionarioAdmissao" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select id="funcionarioStatus" class="form-control" required>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                            <option value="ferias">Férias</option>
                            <option value="afastado">Afastado</option>
                            <option value="licenca">Licença</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Turno de Trabalho</label>
                        <select id="funcionarioTurno" class="form-control">
                            <option value="">Selecione</option>
                            <option value="manha">Manhã (6h-14h)</option>
                            <option value="tarde">Tarde (14h-22h)</option>
                            <option value="noite">Noite (22h-6h)</option>
                            <option value="integral">Integral (8h-18h)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Comissão (%)</label>
                        <input type="number" id="funcionarioComissao" class="form-control" min="0" max="100" step="0.1" value="0">
                        <span class="form-help">Percentual sobre vendas</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea id="funcionarioObservacoes" class="form-control" rows="2" placeholder="Observações sobre o funcionário"></textarea>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="btnSalvarFuncionario">
                        <i class="fas fa-save"></i> Salvar Funcionário
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalFuncionario')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalVenda">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-receipt"></i>
                    Detalhes da Venda
                </h3>
                <button class="close-modal" onclick="fecharModal('modalVenda')">&times;</button>
            </div>
            <div id="vendaDetalhes">
                <!-- Detalhes da venda serão preenchidos aqui -->
            </div>
        </div>
    </div>

    <div class="modal" id="modalConfig">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-cog"></i>
                    Configurações do Sistema
                </h3>
                <button class="close-modal" onclick="fecharModal('modalConfig')">&times;</button>
            </div>
            <form id="formConfig">
                <div class="tabs">
                    <button type="button" class="tab active" onclick="switchConfigTab('geral')">Geral</button>
                    <button type="button" class="tab" onclick="switchConfigTab('loja')">Loja</button>
                    <button type="button" class="tab" onclick="switchConfigTab('vendas')">Vendas</button>
                    <button type="button" class="tab" onclick="switchConfigTab('estoque')">Estoque</button>
                    <button type="button" class="tab" onclick="switchConfigTab="></button>
                </div>
                
                <div id="configGeral" class="config-tab active">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nome do Sistema</label>
                            <input type="text" id="configNomeSistema" class="form-control" value="SuperMercado Pro">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Moeda</label>
                            <select id="configMoeda" class="form-control">
                                <option value="BRL">Real Brasileiro (R$)</option>
                                <option value="USD">Dólar Americano ($)</option>
                                <option value="EUR">Euro (€)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fuso Horário</label>
                            <select id="configFusoHorario" class="form-control">
                                <option value="America/Sao_Paulo">Brasília (GMT-3)</option>
                                <option value="America/New_York">Nova York (GMT-5)</option>
                                <option value="Europe/London">Londres (GMT+0)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Idioma</label>
                            <select id="configIdioma" class="form-control">
                                <option value="pt-BR">Português (Brasil)</option>
                                <option value="en-US">Inglês (EUA)</option>
                                <option value="es-ES">Espanhol</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="configLoja" class="config-tab" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Nome da Loja *</label>
                        <input type="text" id="configNomeLoja" class="form-control" required placeholder="Ex: SuperMercado Central">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Logo (URL)</label>
                        <input type="url" id="configLogoUrl" class="form-control" placeholder="https://exemplo.com/logo.png">
                        <span class="form-help">Insira a URL da imagem do logo</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="text" id="configTelefone" class="form-control" placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label class="form-label">WhatsApp</label>
                            <input type="text" id="configWhatsApp" class="form-control" placeholder="5511999999999">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Endereço Completo</label>
                        <textarea id="configEndereco" class="form-control" rows="3" placeholder="Endereço completo da loja"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CNPJ</label>
                            <input type="text" id="configCNPJ" class="form-control" placeholder="00.000.000/0000-00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Inscrição Estadual</label>
                            <input type="text" id="configIE" class="form-control" placeholder="Inscrição estadual">
                        </div>
                    </div>
                </div>
                
                <div id="configVendas" class="config-tab" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Imposto Padrão (%)</label>
                            <input type="number" id="configImposto" class="form-control" min="0" max="100" value="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taxa de Cartão (%)</label>
                            <input type="number" id="configTaxaCartao" class="form-control" min="0" max="100" value="2.5" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Formas de Pagamento Aceitas</label>
                        <div class="payment-methods">
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'dinheiro')">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Dinheiro</span>
                            </div>
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'cartao_credito')">
                                <i class="fas fa-credit-card"></i>
                                <span>Cartão Crédito</span>
                            </div>
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'cartao_debito')">
                                <i class="fas fa-credit-card"></i>
                                <span>Cartão Débito</span>
                            </div>
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'pix')">
                                <i class="fas fa-qrcode"></i>
                                <span>PIX</span>
                            </div>
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'vale_alimentacao')">
                                <i class="fas fa-utensils"></i>
                                <span>Vale Alimentação</span>
                            </div>
                            <div class="payment-method" onclick="togglePaymentMethod(this, 'vale_refeicao')">
                                <i class="fas fa-utensils"></i>
                                <span>Vale Refeição</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Imprimir Comprovante Automaticamente</label>
                        <select id="configImprimirAuto" class="form-control">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pedir CPF na Venda</label>
                        <select id="configPedirCPF" class="form-control">
                            <option value="opcional">Opcional</option>
                            <option value="obrigatorio">Obrigatório</option>
                            <option value="nao">Não pedir</option>
                        </select>
                    </div>
                </div>
                
                <div id="configEstoque" class="config-tab" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Estoque Mínimo Padrão</label>
                            <input type="number" id="configEstoqueMinimo" class="form-control" min="1" value="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Alerta de Estoque Baixo</label>
                            <select id="configAlertaEstoque" class="form-control">
                                <option value="sim">Ativar Alertas</option>
                                <option value="nao">Desativar Alertas</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Controlar Validade de Produtos</label>
                        <select id="configControlarValidade" class="form-control">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dias para Alerta de Validade</label>
                        <input type="number" id="configDiasValidade" class="form-control" min="1" value="30">
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Configurações
                    </button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalConfig')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="modalComprovante">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-receipt"></i>
                    Comprovante de Venda
                </h3>
                <button class="close-modal" onclick="fecharModal('modalComprovante')">&times;</button>
            </div>
            <div class="comprovante-preview" id="comprovantePreview">
                <div class="comprovante-header">
                    <h2 class="comprovante-title" id="comprovanteNomeLoja">SUPERMERCADO PRO</h2>
                    <p id="comprovanteEndereco">Endereço não configurado</p>
                    <p id="comprovanteTelefone">Telefone não configurado</p>
                    <p id="comprovanteCNPJ">CNPJ: Não informado</p>
                    <p id="comprovanteData">Data: 01/01/2024 10:00:00</p>
                    <p id="comprovanteVenda">Venda: #000001</p>
                    <p id="comprovanteVendedor">Vendedor: Sistema</p>
                </div>
                <div class="comprovante-items" id="comprovanteItems">
                    <!-- Itens serão inseridos aqui -->
                </div>
                <div class="comprovante-total">
                    <span>TOTAL:</span>
                    <span id="comprovanteTotal">R$ 0,00</span>
                </div>
                <div style="text-align: center; margin-top: 25px; color: var(--gray); padding-top: 20px; border-top: 1px dashed #e0e6ed;">
                    <p>Obrigado pela preferência!</p>
                    <p>Volte sempre!</p>
                </div>
            </div>
            <div style="display: flex; gap: 15px; margin-top: 25px; justify-content: center;">
                <button class="btn btn-primary" onclick="imprimirComprovante()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" onclick="salvarComprovante()">
                    <i class="fas fa-download"></i> Salvar PDF
                </button>
                <button class="btn btn-outline" onclick="fecharModal('modalComprovante')">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Layout Principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-store-alt"></i>
                    <span class="logo-text">SuperMercado Pro</span>
                </div>
                <div class="store-info">
                    <div class="store-name" id="storeName">Minha Loja</div>
                    <div id="storeCNPJ">CNPJ: 00.000.000/0000-00</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Vendas</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="caixa">
                            <i class="fas fa-cash-register"></i>
                            <span>Caixa (PDV)</span>
                            <span class="nav-badge" id="badgeCaixa">PDV</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="vendas">
                            <i class="fas fa-chart-bar"></i>
                            <span>Histórico de Vendas</span>
                            <span class="nav-badge" id="badgeVendas">0</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Cadastros</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="produtos">
                            <i class="fas fa-boxes"></i>
                            <span>Produtos</span>
                            <span class="nav-badge" id="badgeProdutos">0</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="clientes">
                            <i class="fas fa-users"></i>
                            <span>Clientes</span>
                            <span class="nav-badge" id="badgeClientes">0</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="funcionarios">
                            <i class="fas fa-user-tie"></i>
                            <span>Funcionários</span>
                            <span class="nav-badge" id="badgeFuncionarios">0</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="fornecedores">
                            <i class="fas fa-truck"></i>
                            <span>Fornecedores</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Relatórios</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="relatorios">
                            <i class="fas fa-file-alt"></i>
                            <span>Relatórios</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="financeiro">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Financeiro</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Sistema</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="configuracoes">
                            <i class="fas fa-cog"></i>
                            <span>Configurações</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="backup">
                            <i class="fas fa-database"></i>
                            <span>Backup</span>
                        </a>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Administrador</div>
                        <div class="user-email" id="userEmail">carregando...</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt"></i> Sair do Sistema
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title" id="headerTitle">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </div>
                </div>
                <div class="header-actions">
                    <div class="current-datetime" id="currentDateTime">
                        Carregando...
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary btn-sm" onclick="mostrarSecao('caixa')" id="btnNovoCaixa">
                            <i class="fas fa-cash-register"></i> Novo Caixa
                        </button>
                        <button class="btn btn-success btn-sm" onclick="mostrarSecao('vendas')">
                            <i class="fas fa-history"></i> Histórico
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- Alertas -->
                <div id="alertContainer"></div>

                <!-- Dashboard -->
                <section id="section-dashboard" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="mostrarSecao('vendas')">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-value" id="statVendasHoje">0</div>
                            <div class="stat-label">Vendas Hoje</div>
                            <div class="stat-change positive" id="statVendasVariacao">+0% vs ontem</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('produtos')">
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-value" id="statProdutos">0</div>
                            <div class="stat-label">Produtos Cadastrados</div>
                            <div class="stat-change" id="statProdutosEstoqueBaixo">0 com estoque baixo</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('clientes')">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="statClientes">0</div>
                            <div class="stat-label">Clientes Cadastrados</div>
                            <div class="stat-change positive" id="statClientesNovos">+0 novos este mês</div>
                        </div>
                        <div class="stat-card" onclick="mostrarSecao('financeiro')">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-value" id="statFaturamento">R$ 0</div>
                            <div class="stat-label">Faturamento do Dia</div>
                            <div class="stat-change positive" id="statFaturamentoMeta">0% da meta</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Vendas dos Últimos 7 Dias
                            </h3>
                            <select class="form-control" style="width: auto;" onchange="atualizarGraficoVendas(this.value)">
                                <option value="7">7 dias</option>
                                <option value="30">30 dias</option>
                                <option value="90">90 dias</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="graficoVendas"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                Produtos com Estoque Baixo
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="carregarProdutos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Produto</th>
                                        <th>Código</th>
                                        <th>Estoque Atual</th>
                                        <th>Estoque Mínimo</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaEstoqueBaixo">
                                    <!-- Dados serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-history"></i>
                                Últimas Vendas
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="mostrarSecao('vendas')">
                                <i class="fas fa-list"></i> Ver Todas
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Data/Hora</th>
                                        <th>Cliente</th>
                                        <th>Produtos</th>
                                        <th>Valor</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaUltimasVendas">
                                    <!-- Dados serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Caixa / PDV -->
                <section id="section-caixa" class="content-section">
                    <div class="caixa-container">
                        <div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-search"></i>
                                        Produtos para Venda
                                    </h3>
                                    <div class="search-container">
                                        <input type="text" id="buscaProdutoCaixa" class="search-input" 
                                               placeholder="Digite nome, código ou use leitor de código de barras..." 
                                               onkeyup="filtrarProdutosCaixa(this.value)"
                                               autofocus>
                                        <button class="btn btn-primary" onclick="abrirModalProduto()">
                                            <i class="fas fa-plus"></i> Novo Produto
                                        </button>
                                    </div>
                                </div>
                                <div class="produtos-grid" id="produtosCaixaGrid">
                                    <!-- Produtos serão carregados aqui -->
                                </div>
                            </div>
                        </div>

                        <div class="carrinho-container">
                            <div class="carrinho-header">
                                <h3 class="card-title">
                                    <i class="fas fa-shopping-cart"></i>
                                    Carrinho de Compras
                                </h3>
                                <button class="btn btn-danger btn-sm" onclick="limparCarrinho()">
                                    <i class="fas fa-trash"></i> Limpar
                                </button>
                            </div>
                            
                            <div id="carrinhoItens">
                                <div style="text-align: center; padding: 50px 20px; color: var(--gray);">
                                    <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                    <p>Nenhum produto no carrinho</p>
                                    <p style="font-size: 0.9rem; margin-top: 10px;">Clique nos produtos ao lado para adicionar</p>
                                </div>
                            </div>
                            
                            <div class="carrinho-total">
                                <div class="total-row">
                                    <span>Subtotal:</span>
                                    <span id="carrinhoSubtotal">R$ 0,00</span>
                                </div>
                                <div class="total-row">
                                    <span>Desconto:</span>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="number" id="carrinhoDesconto" class="form-control" 
                                               style="width: 100px; text-align: right;" 
                                               value="0" min="0" step="0.01" onchange="calcularTotalCarrinho()">
                                        <span>R$</span>
                                    </div>
                                </div>
                                <div class="total-row" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e6ed;">
                                    <strong>TOTAL:</strong>
                                    <strong class="total-grande" id="carrinhoTotal">R$ 0,00</strong>
                                </div>
                            </div>
                            
                            <div style="margin-top: 30px;">
                                <div class="form-group">
                                    <label class="form-label">Cliente</label>
                                    <div style="display: flex; gap: 10px;">
                                        <select id="clienteVenda" class="form-control" onchange="selecionarClienteVenda(this.value)">
                                            <option value="">Cliente não identificado</option>
                                        </select>
                                        <button class="btn btn-success btn-sm" onclick="abrirModalCliente()">
                                            <i class="fas fa-user-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Forma de Pagamento</label>
                                    <div class="payment-methods" id="paymentMethods">
                                        <!-- Métodos de pagamento serão carregados aqui -->
                                    </div>
                                </div>
                                
                                <div id="campoDinheiro" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Valor Recebido (R$)</label>
                                            <input type="number" id="valorRecebido" class="form-control" 
                                                   step="0.01" min="0" onchange="calcularTroco()">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Troco (R$)</label>
                                            <input type="number" id="valorTroco" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="campoCartao" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Nº do Cartão (últimos 4)</label>
                                            <input type="text" id="numeroCartao" class="form-control" maxlength="4">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Parcelas</label>
                                            <select id="parcelasCartao" class="form-control">
                                                <option value="1">1x</option>
                                                <option value="2">2x</option>
                                                <option value="3">3x</option>
                                                <option value="4">4x</option>
                                                <option value="5">5x</option>
                                                <option value="6">6x</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 16px;" 
                                        onclick="finalizarVenda()" id="btnFinalizarVenda">
                                    <i class="fas fa-check-circle"></i> Finalizar Venda
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Produtos -->
                <section id="section-produtos" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-boxes"></i>
                                Gerenciar Produtos
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaProdutos" class="form-control" 
                                       placeholder="Buscar por nome, código ou categoria..." 
                                       onkeyup="filtrarProdutosAdmin(this.value)">
                                <button class="btn btn-success" onclick="abrirModalProduto()">
                                    <i class="fas fa-plus"></i> Novo Produto
                                </button>
                                <button class="btn btn-primary" onclick="exportarProdutos()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="filters">
                            <div class="filter-group">
                                <label>Categoria:</label>
                                <select id="filtroCategoria" class="form-control" onchange="filtrarProdutosPorCategoria(this.value)" style="width: 150px;">
                                    <option value="">Todas</option>
                                    <option value="alimentos">Alimentos</option>
                                    <option value="bebidas">Bebidas</option>
                                    <option value="limpeza">Limpeza</option>
                                    <option value="higiene">Higiene</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Estoque:</label>
                                <select id="filtroEstoque" class="form-control" onchange="filtrarProdutosPorEstoque(this.value)" style="width: 150px;">
                                    <option value="">Todos</option>
                                    <option value="baixo">Estoque Baixo</option>
                                    <option value="normal">Estoque Normal</option>
                                    <option value="sem">Sem Estoque</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Produto</th>
                                        <th>Categoria</th>
                                        <th>Preço Custo</th>
                                        <th>Preço Venda</th>
                                        <th>Estoque</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaProdutos">
                                    <!-- Produtos serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="paginationProdutos">
                            <!-- Paginação será gerada aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                Estatísticas de Produtos
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="gerarRelatorioProdutos()">
                                <i class="fas fa-file-pdf"></i> Relatório PDF
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="stat-card">
                                <div class="stat-value" id="totalProdutosCadastrados">0</div>
                                <div class="stat-label">Total Produtos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="valorTotalEstoque">R$ 0</div>
                                <div class="stat-label">Valor em Estoque</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="produtosSemEstoqueCount">0</div>
                                <div class="stat-label">Sem Estoque</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="categoriaMaisProdutos">-</div>
                                <div class="stat-label">Categoria Maior</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Clientes -->
                <section id="section-clientes" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-users"></i>
                                Gerenciar Clientes
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaClientes" class="form-control" 
                                       placeholder="Buscar por nome, CPF ou telefone..." 
                                       onkeyup="filtrarClientes(this.value)">
                                <button class="btn btn-success" onclick="abrirModalCliente()">
                                    <i class="fas fa-user-plus"></i> Novo Cliente
                                </button>
                                <button class="btn btn-primary" onclick="exportarClientes()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Telefone</th>
                                        <th>Email</th>
                                        <th>Tipo</th>
                                        <th>Total Compras</th>
                                        <th>Última Compra</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaClientes">
                                    <!-- Clientes serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="paginationClientes">
                            <!-- Paginação será gerada aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i>
                                Análise de Clientes
                            </h3>
                            <select class="form-control" style="width: auto;" onchange="atualizarGraficoClientes(this.value)">
                                <option value="mensal">Mensal</option>
                                <option value="trimestral">Trimestral</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="graficoClientes"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Funcionários -->
                <section id="section-funcionarios" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-tie"></i>
                                Gerenciar Funcionários
                            </h3>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscaFuncionarios" class="form-control" 
                                       placeholder="Buscar por nome, cargo ou CPF..." 
                                       onkeyup="filtrarFuncionarios(this.value)">
                                <button class="btn btn-success" onclick="abrirModalFuncionario()">
                                    <i class="fas fa-user-plus"></i> Novo Funcionário
                                </button>
                                <button class="btn btn-primary" onclick="exportarFuncionarios()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Cargo</th>
                                        <th>CPF</th>
                                        <th>Telefone</th>
                                        <th>Salário</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaFuncionarios">
                                    <!-- Funcionários serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="paginationFuncionarios">
                            <!-- Paginação será gerada aqui -->
                        </div>
                    </div>
                </section>

                <!-- Vendas -->
                <section id="section-vendas" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Histórico de Vendas
                            </h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <input type="date" id="dataInicioVendas" class="form-control" style="min-width: 150px;">
                                <input type="date" id="dataFimVendas" class="form-control" style="min-width: 150px;">
                                <select id="filtroStatusVenda" class="form-control" style="min-width: 150px;">
                                    <option value="">Todos os Status</option>
                                    <option value="concluída">Concluídas</option>
                                    <option value="cancelada">Canceladas</option>
                                    <option value="pendente">Pendentes</option>
                                </select>
                                <button class="btn btn-primary" onclick="filtrarVendas()">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                                <button class="btn btn-success" onclick="exportarVendas()">
                                    <i class="fas fa-file-excel"></i> Exportar Excel
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data/Hora</th>
                                        <th>Cliente</th>
                                        <th>Produtos</th>
                                        <th>Valor</th>
                                        <th>Pagamento</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaVendas">
                                    <!-- Vendas serão carregadas aqui -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="paginationVendas">
                            <!-- Paginação será gerada aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-exchange-alt"></i>
                                Cancelamento de Vendas
                            </h3>
                            <button class="btn btn-warning btn-sm" onclick="carregarCancelamentos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID Venda</th>
                                        <th>Cliente</th>
                                        <th>Valor</th>
                                        <th>Solicitado Por</th>
                                        <th>Motivo</th>
                                        <th>Data Solicitação</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaCancelamentos">
                                    <!-- Cancelamentos serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Relatórios -->
                <section id="section-relatorios" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-alt"></i>
                                Gerar Relatórios
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="gerarRelatorioCompleto()">
                                <i class="fas fa-file-pdf"></i> PDF Completo
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
                            <div class="card" style="text-align: center; padding: 25px;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-chart-line"></i> Vendas
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Relatório detalhado de vendas por período</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('vendas')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center; padding: 25px;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-boxes"></i> Estoque
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise de estoque e produtos</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('estoque')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center; padding: 25px;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-users"></i> Clientes
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise de clientes e fidelidade</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('clientes')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                            <div class="card" style="text-align: center; padding: 25px;">
                                <div class="card-title" style="justify-content: center;">
                                    <i class="fas fa-money-bill-wave"></i> Financeiro
                                </div>
                                <p style="color: var(--gray); margin-bottom: 25px;">Análise financeira completa</p>
                                <button class="btn btn-primary" onclick="gerarRelatorioTipo('financeiro')">
                                    <i class="fas fa-download"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-download"></i>
                                Exportar Dados
                            </h3>
                            <button class="btn btn-success" onclick="exportarTodosDados()">
                                <i class="fas fa-file-excel"></i> Exportar Tudo
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; padding: 20px;">
                            <button class="btn btn-outline" onclick="exportarDados('produtos')">
                                <i class="fas fa-box"></i> Produtos
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('clientes')">
                                <i class="fas fa-users"></i> Clientes
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('vendas')">
                                <i class="fas fa-shopping-cart"></i> Vendas
                            </button>
                            <button class="btn btn-outline" onclick="exportarDados('funcionarios')">
                                <i class="fas fa-user-tie"></i> Funcionários
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Configurações -->
                <section id="section-configuracoes" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-cog"></i>
                                Configurações do Sistema
                            </h3>
                            <button class="btn btn-primary" onclick="abrirModal('modalConfig')">
                                <i class="fas fa-edit"></i> Editar Configurações
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 20px;">Informações da Loja</h4>
                                <div id="infoLoja">
                                    <!-- Informações serão carregadas aqui -->
                                </div>
                            </div>
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 20px;">Estatísticas do Sistema</h4>
                                <div id="infoSistema">
                                    <!-- Informações serão carregadas aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Segurança e Backup
                            </h3>
                            <button class="btn btn-warning" onclick="criarBackup()">
                                <i class="fas fa-database"></i> Criar Backup
                            </button>
                        </div>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap; padding: 20px;">
                            <button class="btn btn-outline" onclick="alterarSenha()">
                                <i class="fas fa-key"></i> Alterar Senha
                            </button>
                            <button class="btn btn-outline" onclick="gerarLogs()">
                                <i class="fas fa-file-alt"></i> Ver Logs
                            </button>
                            <button class="btn btn-outline" onclick="restaurarBackup()">
                                <i class="fas fa-undo"></i> Restaurar Backup
                            </button>
                            <button class="btn btn-danger" onclick="limparDados()">
                                <i class="fas fa-trash"></i> Limpar Dados
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts Externos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // ========== VARIÁVEIS GLOBAIS ==========
        let produtos = [];
        let clientes = [];
        let funcionarios = [];
        let vendas = [];
        let carrinho = [];
        let configuracoes = {};
        let graficoVendas = null;
        let graficoClientes = null;
        let currentPage = {
            produtos: 1,
            clientes: 1,
            funcionarios: 1,
            vendas: 1
        };
        const itemsPerPage = 10;
        
        // ========== INICIALIZAÇÃO ==========
        function initSistema() {
            console.log("Inicializando sistema administrativo...");
            
            // Configurar data/hora
            atualizarDataHora();
            setInterval(atualizarDataHora, 1000);
            
            // Configurar navegação
            configurarNavegacao();
            
            // Configurar menu mobile
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Configurar formulários
            configurarFormularios();
            
            // Carregar configurações
            carregarConfiguracoes();
            
            // Carregar dados iniciais
            carregarDadosIniciais();
            
            // Verificar se há seção específica na URL
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            if (section) {
                mostrarSecao(section);
            }
            
            // Configurar atalhos de teclado
            configurarAtalhosTeclado();
        }
        
        // ========== ATALHOS DE TECLADO ==========
        function configurarAtalhosTeclado() {
            document.addEventListener('keydown', function(e) {
                // Ctrl + N - Nova venda
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    mostrarSecao('caixa');
                }
                
                // Ctrl + P - Produtos
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    mostrarSecao('produtos');
                }
                
                // Ctrl + S - Salvar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    // Implementar lógica de salvar baseada no contexto
                }
                
                // F1 - Ajuda
                if (e.key === 'F1') {
                    e.preventDefault();
                    alert('Atalhos disponíveis:\n\nCtrl+N: Nova venda\nCtrl+P: Produtos\nCtrl+S: Salvar\nF1: Ajuda\nEsc: Fechar modal');
                }
                
                // Esc - Fechar modal
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal.active');
                    if (modals.length > 0) {
                        const modalId = modals[0].id;
                        fecharModal(modalId);
                    }
                }
            });
        }
        
        // ========== NAVEGAÇÃO ==========
        function configurarNavegacao() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    mostrarSecao(section);
                    
                    // Atualizar links ativos
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Fechar menu mobile se aberto
                    if (window.innerWidth <= 992) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
        }
        
        function mostrarSecao(sectionName) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar seção selecionada
            const targetSection = document.getElementById(`section-${sectionName}`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Atualizar título
            const titles = {
                'dashboard': 'Dashboard',
                'caixa': 'Caixa (PDV)',
                'produtos': 'Produtos',
                'clientes': 'Clientes',
                'funcionarios': 'Funcionários',
                'vendas': 'Vendas',
                'relatorios': 'Relatórios',
                'configuracoes': 'Configurações',
                'financeiro': 'Financeiro',
                'fornecedores': 'Fornecedores',
                'backup': 'Backup'
            };
            
            const icons = {
                'dashboard': 'tachometer-alt',
                'caixa': 'cash-register',
                'produtos': 'boxes',
                'clientes': 'users',
                'funcionarios': 'user-tie',
                'vendas': 'chart-bar',
                'relatorios': 'file-alt',
                'configuracoes': 'cog',
                'financeiro': 'money-bill-wave',
                'fornecedores': 'truck',
                'backup': 'database'
            };
            
            document.getElementById('headerTitle').innerHTML = 
                `<i class="fas fa-${icons[sectionName] || 'cog'}"></i> ${titles[sectionName] || sectionName}`;
            
            // Carregar dados da seção
            switch(sectionName) {
                case 'dashboard':
                    carregarDashboard();
                    break;
                case 'caixa':
                    carregarCaixa();
                    break;
                case 'produtos':
                    carregarProdutos();
                    break;
                case 'clientes':
                    carregarClientes();
                    break;
                case 'funcionarios':
                    carregarFuncionarios();
                    break;
                case 'vendas':
                    carregarVendas();
                    break;
                case 'configuracoes':
                    carregarInfoConfiguracoes();
                    break;
                case 'financeiro':
                    carregarFinanceiro();
                    break;
            }
        }
        
        // ========== DATA/HORA ==========
        function atualizarDataHora() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = 
                now.toLocaleDateString('pt-BR', options);
        }
        
        // ========== MODAIS ==========
        function abrirModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function fecharModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function abrirModalProduto() {
            document.getElementById('modalProdutoTitulo').textContent = 'Novo Produto';
            document.getElementById('produtoId').value = '';
            document.getElementById('formProduto').reset();
            document.getElementById('produtoEstoque').value = '0';
            document.getElementById('produtoEstoqueMinimo').value = '5';
            document.getElementById('produtoPrecoCusto').value = '';
            document.getElementById('produtoPrecoVenda').value = '';
            document.getElementById('margemLucro').textContent = 'Margem de lucro: 0%';
            abrirModal('modalProduto');
        }
        
        function abrirModalCliente() {
            document.getElementById('modalClienteTitulo').textContent = 'Novo Cliente';
            document.getElementById('clienteId').value = '';
            document.getElementById('formCliente').reset();
            abrirModal('modalCliente');
        }
        
        function abrirModalFuncionario() {
            document.getElementById('modalFuncionarioTitulo').textContent = 'Novo Funcionário';
            document.getElementById('funcionarioId').value = '';
            document.getElementById('formFuncionario').reset();
            // Definir data de admissão como hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('funcionarioAdmissao').value = hoje;
            abrirModal('modalFuncionario');
        }
        
        function switchConfigTab(tab) {
            const tabs = document.querySelectorAll('.config-tab');
            const tabButtons = document.querySelectorAll('#modalConfig .tab');
            
            tabs.forEach(t => t.style.display = 'none');
            tabButtons.forEach(b => b.classList.remove('active'));
            
            const tabElement = document.getElementById(`config${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            if (tabElement) {
                tabElement.style.display = 'block';
            }
            
            document.querySelector(`#modalConfig .tab[onclick="switchConfigTab('${tab}')"]`).classList.add('active');
        }
        
        // ========== FORMATAÇÃO ==========
        function formatarCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            
            input.value = value;
        }
        
        function formatarTelefone(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length === 11) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            } else if (value.length === 10) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }
            
            input.value = value;
        }
        
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }
        
        // ========== ALERTAS ==========
        function mostrarAlerta(mensagem, tipo = 'info', tempo = 5000) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${tipo}`;
            
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            
            alert.innerHTML = `
                <i class="fas fa-${icons[tipo] || 'info-circle'}"></i>
                <span>${mensagem}</span>
            `;
            
            alertContainer.insertBefore(alert, alertContainer.firstChild);
            
            // Remover após o tempo especificado
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, tempo);
        }
        
        // ========== CONFIGURAÇÕES ==========
        async function carregarConfiguracoes() {
            try {
                const db = window.firebaseDb;
                const docRef = window.firebaseDoc(db, "configuracoes", "geral");
                const docSnap = await window.firebaseGetDoc(docRef);
                
                if (docSnap.exists()) {
                    configuracoes = docSnap.data();
                    
                    // Atualizar informações da loja na sidebar
                    if (configuracoes.nomeLoja) {
                        document.getElementById('storeName').textContent = configuracoes.nomeLoja;
                    }
                    if (configuracoes.cnpj) {
                        document.getElementById('storeCNPJ').textContent = `CNPJ: ${configuracoes.cnpj}`;
                    }
                    
                } else {
                    // Configurações padrão
                    configuracoes = {
                        nomeLoja: "SuperMercado Pro",
                        cnpj: "",
                        telefone: "",
                        whatsApp: "",
                        endereco: "",
                        imposto: 0,
                        taxaCartao: 2.5,
                        formasPagamento: ['dinheiro', 'cartao_debito', 'cartao_credito', 'pix']
                    };
                    
                    // Salvar configurações padrão
                    await window.firebaseSetDoc(docRef, configuracoes);
                }
                
                console.log("Configurações carregadas:", configuracoes);
                
            } catch (error) {
                console.error("Erro ao carregar configurações:", error);
                mostrarAlerta("Erro ao carregar configurações", "error");
            }
        }
        
        async function salvarConfiguracoes() {
            try {
                const db = window.firebaseDb;
                const docRef = window.firebaseDoc(db, "configuracoes", "geral");
                
                configuracoes.nomeLoja = document.getElementById('configNomeLoja').value;
                configuracoes.cnpj = document.getElementById('configCNPJ').value;
                configuracoes.telefone = document.getElementById('configTelefone').value;
                configuracoes.whatsApp = document.getElementById('configWhatsApp').value;
                configuracoes.endereco = document.getElementById('configEndereco').value;
                configuracoes.imposto = parseFloat(document.getElementById('configImposto').value) || 0;
                configuracoes.taxaCartao = parseFloat(document.getElementById('configTaxaCartao').value) || 2.5;
                
                await window.firebaseSetDoc(docRef, configuracoes);
                
                // Atualizar informações da loja na sidebar
                document.getElementById('storeName').textContent = configuracoes.nomeLoja;
                document.getElementById('storeCNPJ').textContent = `CNPJ: ${configuracoes.cnpj || 'Não informado'}`;
                
                mostrarAlerta("Configurações salvas com sucesso!", "success");
                fecharModal('modalConfig');
                
            } catch (error) {
                console.error("Erro ao salvar configurações:", error);
                mostrarAlerta("Erro ao salvar configurações", "error");
            }
        }
        
        function carregarInfoConfiguracoes() {
            const infoLoja = document.getElementById('infoLoja');
            const infoSistema = document.getElementById('infoSistema');
            
            infoLoja.innerHTML = `
                <p><strong>Nome da Loja:</strong> ${configuracoes.nomeLoja || 'Não configurado'}</p>
                <p><strong>CNPJ:</strong> ${configuracoes.cnpj || 'Não informado'}</p>
                <p><strong>Telefone:</strong> ${configuracoes.telefone || 'Não informado'}</p>
                <p><strong>Endereço:</strong> ${configuracoes.endereco || 'Não informado'}</p>
                <p><strong>Imposto Padrão:</strong> ${configuracoes.imposto || 0}%</p>
            `;
            
            infoSistema.innerHTML = `
                <p><strong>Total de Produtos:</strong> <span id="totalProdutosConfig">0</span></p>
                <p><strong>Total de Clientes:</strong> <span id="totalClientesConfig">0</span></p>
                <p><strong>Total de Vendas:</strong> <span id="totalVendasConfig">0</span></p>
                <p><strong>Valor em Estoque:</strong> <span id="valorEstoqueConfig">R$ 0,00</span></p>
                <p><strong>Último Backup:</strong> Não realizado</p>
            `;
        }
        
        // ========== FORMULÁRIOS ==========
        function configurarFormularios() {
            // Formulário de produto
            document.getElementById('formProduto').addEventListener('submit', salvarProduto);
            
            // Cálculo automático de margem
            document.getElementById('produtoPrecoCusto').addEventListener('input', calcularMargem);
            document.getElementById('produtoPrecoVenda').addEventListener('input', calcularMargem);
            
            // Controle de validade
            document.getElementById('produtoControlarValidade').addEventListener('change', function() {
                document.getElementById('validadeContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            // Formulário de cliente
            document.getElementById('formCliente').addEventListener('submit', salvarCliente);
            
            // Formulário de funcionário
            document.getElementById('formFuncionario').addEventListener('submit', salvarFuncionario);
            
            // Formulário de configurações
            document.getElementById('formConfig').addEventListener('submit', function(e) {
                e.preventDefault();
                salvarConfiguracoes();
            });
        }
        
        function calcularMargem() {
            const custo = parseFloat(document.getElementById('produtoPrecoCusto').value) || 0;
            const venda = parseFloat(document.getElementById('produtoPrecoVenda').value) || 0;
            
            if (custo > 0 && venda > 0) {
                const margem = ((venda - custo) / venda) * 100;
                const margemElement = document.getElementById('margemLucro');
                margemElement.textContent = `Margem de lucro: ${margem.toFixed(1)}%`;
                margemElement.style.color = margem >= 20 ? 'var(--success)' : margem >= 10 ? 'var(--warning)' : 'var(--danger)';
            }
        }
        
        // ========== DASHBOARD ==========
        async function carregarDashboard() {
            await carregarEstatisticasDashboard();
            await carregarProdutosEstoqueBaixo();
            await carregarUltimasVendas();
            criarGraficoVendas();
        }
        
        async function carregarEstatisticasDashboard() {
            try {
                const db = window.firebaseDb;
                
                // Carregar produtos
                const produtosSnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "produtos"));
                const totalProdutos = produtosSnapshot.size;
                
                // Carregar clientes
                const clientesSnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "clientes"));
                const totalClientes = clientesSnapshot.size;
                
                // Carregar vendas
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                const ontem = new Date(hoje);
                ontem.setDate(ontem.getDate() - 1);
                
                const vendasSnapshot = await window.firebaseGetDocs(window.firebaseQuery(
                    window.firebaseCollection(db, "vendas"),
                    window.firebaseWhere("status", "==", "concluída")
                ));
                
                let vendasHoje = 0;
                let vendasOntem = 0;
                let faturamentoHoje = 0;
                
                vendasSnapshot.forEach(doc => {
                    const venda = doc.data();
                    const dataVenda = new Date(venda.data);
                    const valor = venda.valorTotal || 0;
                    
                    if (dataVenda >= hoje) {
                        vendasHoje++;
                        faturamentoHoje += valor;
                    }
                    if (dataVenda >= ontem && dataVenda < hoje) {
                        vendasOntem++;
                    }
                });
                
                // Calcular variação
                const variacaoVendas = vendasOntem > 0 ? ((vendasHoje - vendasOntem) / vendasOntem * 100).toFixed(1) : 0;
                
                // Produtos com estoque baixo
                let estoqueBaixo = 0;
                produtosSnapshot.forEach(doc => {
                    const produto = doc.data();
                    if (produto.estoque <= (produto.estoqueMinimo || 5)) {
                        estoqueBaixo++;
                    }
                });
                
                // Atualizar estatísticas
                document.getElementById('statVendasHoje').textContent = vendasHoje;
                document.getElementById('statProdutos').textContent = totalProdutos;
                document.getElementById('statClientes').textContent = totalClientes;
                document.getElementById('statFaturamento').textContent = formatarMoeda(faturamentoHoje);
                
                // Atualizar badges na sidebar
                document.getElementById('badgeProdutos').textContent = totalProdutos;
                document.getElementById('badgeClientes').textContent = totalClientes;
                document.getElementById('badgeVendas').textContent = vendasSnapshot.size;
                document.getElementById('badgeFuncionarios').textContent = funcionarios.length;
                
                // Atualizar variações
                document.getElementById('statVendasVariacao').textContent = 
                    `${variacaoVendas >= 0 ? '+' : ''}${variacaoVendas}% vs ontem`;
                document.getElementById('statVendasVariacao').className = 
                    `stat-change ${variacaoVendas >= 0 ? 'positive' : 'negative'}`;
                
                document.getElementById('statProdutosEstoqueBaixo').textContent = 
                    `${estoqueBaixo} com estoque baixo`;
                
                // Atualizar também na seção de configurações
                document.getElementById('totalProdutosConfig').textContent = totalProdutos;
                document.getElementById('totalClientesConfig').textContent = totalClientes;
                document.getElementById('totalVendasConfig').textContent = vendasSnapshot.size;
                
            } catch (error) {
                console.error("Erro ao carregar estatísticas do dashboard:", error);
            }
        }
        
        async function carregarProdutosEstoqueBaixo() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "produtos"));
                
                const produtosBaixo = [];
                querySnapshot.forEach(doc => {
                    const produto = { id: doc.id, ...doc.data() };
                    if (produto.estoque <= (produto.estoqueMinimo || 5)) {
                        produtosBaixo.push(produto);
                    }
                });
                
                const tbody = document.getElementById('tabelaEstoqueBaixo');
                tbody.innerHTML = '';
                
                if (produtosBaixo.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="table-empty">
                                <i class="fas fa-check-circle"></i>
                                <p>Todos os produtos com estoque adequado</p>
                            </td>
                        </tr>
                    `;
                } else {
                    produtosBaixo.forEach(produto => {
                        const status = produto.estoque <= 0 ? 
                            `<span class="badge badge-danger">ESGOTADO</span>` :
                            `<span class="badge badge-warning">BAIXO</span>`;
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>
                                <div><strong>${produto.nome}</strong></div>
                                ${produto.descricao ? `<small>${produto.descricao.substring(0, 50)}...</small>` : ''}
                            </td>
                            <td>${produto.codigo || '-'}</td>
                            <td>${produto.estoque}</td>
                            <td>${produto.estoqueMinimo || 5}</td>
                            <td>${status}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-primary btn-xs" onclick="editarProduto('${produto.id}')" data-tooltip="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-success btn-xs" onclick="reporEstoque('${produto.id}')" data-tooltip="Repor Estoque">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
            } catch (error) {
                console.error("Erro ao carregar produtos com estoque baixo:", error);
            }
        }
        
        async function carregarUltimasVendas() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(
                    window.firebaseQuery(
                        window.firebaseCollection(db, "vendas"),
                        window.firebaseOrderBy("data", "desc"),
                        window.firebaseWhere("status", "==", "concluída")
                    )
                );
                
                const ultimasVendas = [];
                querySnapshot.forEach(doc => {
                    ultimasVendas.push({ id: doc.id, ...doc.data() });
                });
                
                const tbody = document.getElementById('tabelaUltimasVendas');
                tbody.innerHTML = '';
                
                if (ultimasVendas.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="table-empty">
                                <i class="fas fa-receipt"></i>
                                <p>Nenhuma venda realizada</p>
                            </td>
                        </tr>
                    `;
                } else {
                    // Mostrar apenas as 5 últimas vendas
                    const vendasExibir = ultimasVendas.slice(0, 5);
                    
                    vendasExibir.forEach(venda => {
                        const produtosLista = venda.itens.slice(0, 2).map(item => 
                            `${item.quantidade}x ${item.nome}`
                        ).join(', ');
                        
                        const maisItens = venda.itens.length > 2 ? ` e +${venda.itens.length - 2}` : '';
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${new Date(venda.data).toLocaleString('pt-BR')}</td>
                            <td>${venda.clienteNome || 'Cliente não identificado'}</td>
                            <td>${produtosLista}${maisItens}</td>
                            <td>${formatarMoeda(venda.valorTotal)}</td>
                            <td><span class="badge badge-success">CONCLUÍDA</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-info btn-xs" onclick="verDetalhesVenda('${venda.id}')" data-tooltip="Ver Detalhes">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
            } catch (error) {
                console.error("Erro ao carregar últimas vendas:", error);
            }
        }
        
        function criarGraficoVendas() {
            const ctx = document.getElementById('graficoVendas').getContext('2d');
            
            if (graficoVendas) {
                graficoVendas.destroy();
            }
            
            // Dados de exemplo
            const labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            const data = [1200, 1900, 1500, 2300, 2800, 3200, 2900];
            
            graficoVendas = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Vendas: ${formatarMoeda(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoVendas(dias) {
            // Em produção, atualizaria o gráfico com dados reais
            mostrarAlerta(`Gráfico atualizado para ${dias} dias`, 'info');
        }
        
        // ========== CAIXA / PDV ==========
        async function carregarCaixa() {
            await carregarProdutosParaCaixa();
            carregarClientesParaVenda();
            carregarMetodosPagamento();
            limparCarrinho();
            
            // Focar no campo de busca
            document.getElementById('buscaProdutoCaixa').focus();
        }
        
        async function carregarProdutosParaCaixa() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "produtos"));
                
                produtos = [];
                querySnapshot.forEach((doc) => {
                    produtos.push({ id: doc.id, ...doc.data() });
                });
                
                const container = document.getElementById('produtosCaixaGrid');
                container.innerHTML = '';
                
                if (produtos.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: var(--gray);">
                            <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <p>Nenhum produto cadastrado</p>
                            <button class="btn btn-primary" onclick="abrirModalProduto()">
                                <i class="fas fa-plus"></i> Cadastrar Primeiro Produto
                            </button>
                        </div>
                    `;
                    return;
                }
                
                produtos.forEach(produto => {
                    const div = document.createElement('div');
                    div.className = `produto-item ${produto.estoque <= 0 ? 'sem-estoque' : ''}`;
                    
                    if (produto.estoque > 0) {
                        div.onclick = () => adicionarAoCarrinho(produto);
                    }
                    
                    const estoqueClass = produto.estoque <= 0 ? 'produto-sem-estoque' : 
                                       produto.estoque <= (produto.estoqueMinimo || 5) ? 'produto-estoque-baixo' : 'produto-estoque';
                    
                    div.innerHTML = `
                        <div class="produto-nome">${produto.nome}</div>
                        <div class="produto-preco">${formatarMoeda(produto.precoVenda)}</div>
                        <div class="${estoqueClass}">
                            Estoque: ${produto.estoque} ${produto.unidade ? produto.unidade : ''}
                        </div>
                        ${produto.codigo ? `<div class="produto-codigo">Cód: ${produto.codigo}</div>` : ''}
                    `;
                    
                    container.appendChild(div);
                });
                
            } catch (error) {
                console.error("Erro ao carregar produtos para caixa:", error);
                mostrarAlerta("Erro ao carregar produtos", "error");
            }
        }
        
        function filtrarProdutosCaixa(termo) {
            const produtosItems = document.querySelectorAll('.produto-item');
            const termoLower = termo.toLowerCase().trim();
            
            if (!termoLower) {
                produtosItems.forEach(item => item.style.display = 'block');
                return;
            }
            
            produtosItems.forEach(item => {
                const nome = item.querySelector('.produto-nome').textContent.toLowerCase();
                const codigo = item.querySelector('.produto-codigo')?.textContent.toLowerCase() || '';
                
                if (nome.includes(termoLower) || codigo.includes(termoLower)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function adicionarAoCarrinho(produto) {
            if (produto.estoque <= 0) {
                mostrarAlerta('Produto sem estoque disponível!', 'error');
                return;
            }
            
            // Verificar se já está no carrinho
            const itemExistente = carrinho.find(item => item.id === produto.id);
            
            if (itemExistente) {
                // Verificar estoque
                if (itemExistente.quantidade >= produto.estoque) {
                    mostrarAlerta('Estoque insuficiente!', 'error');
                    return;
                }
                itemExistente.quantidade++;
            } else {
                carrinho.push({
                    id: produto.id,
                    codigo: produto.codigo,
                    nome: produto.nome,
                    preco: produto.precoVenda,
                    quantidade: 1,
                    estoque: produto.estoque,
                    unidade: produto.unidade
                });
            }
            
            atualizarCarrinho();
            
            // Feedback visual
            const produtoElement = document.querySelector(`.produto-item .produto-nome:contains("${produto.nome}")`)?.closest('.produto-item');
            if (produtoElement) {
                produtoElement.style.animation = 'pulse 0.5s';
                setTimeout(() => {
                    produtoElement.style.animation = '';
                }, 500);
            }
        }
        
        function atualizarCarrinho() {
            const container = document.getElementById('carrinhoItens');
            
            if (carrinho.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--gray);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Nenhum produto no carrinho</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Clique nos produtos ao lado para adicionar</p>
                    </div>
                `;
            } else {
                let html = '';
                carrinho.forEach((item, index) => {
                    const subtotal = item.preco * item.quantidade;
                    html += `
                        <div class="carrinho-item">
                            <div class="carrinho-item-info">
                                <div class="carrinho-item-nome">${item.nome}</div>
                                <div class="carrinho-item-preco">${formatarMoeda(item.preco)} ${item.unidade ? `/${item.unidade}` : ''}</div>
                            </div>
                            <div class="carrinho-item-actions">
                                <div class="carrinho-item-quantidade">
                                    <button onclick="alterarQuantidadeCarrinho(${index}, -1)" ${item.quantidade <= 1 ? 'disabled' : ''}>
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span>${item.quantidade}</span>
                                    <button onclick="alterarQuantidadeCarrinho(${index}, 1)" ${item.quantidade >= item.estoque ? 'disabled' : ''}>
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div style="text-align: right; min-width: 80px;">
                                    <div style="font-weight: 700; color: var(--success);">${formatarMoeda(subtotal)}</div>
                                </div>
                                <button class="btn btn-danger btn-xs" onclick="removerDoCarrinho(${index})" data-tooltip="Remover">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            
            calcularTotalCarrinho();
            
            // Atualizar badge no botão de finalizar venda
            const btnFinalizar = document.getElementById('btnFinalizarVenda');
            if (carrinho.length > 0) {
                btnFinalizar.innerHTML = `<i class="fas fa-check-circle"></i> Finalizar Venda (${carrinho.length} itens)`;
                btnFinalizar.disabled = false;
            } else {
                btnFinalizar.innerHTML = `<i class="fas fa-check-circle"></i> Finalizar Venda`;
                btnFinalizar.disabled = true;
            }
        }
        
        function alterarQuantidadeCarrinho(index, delta) {
            const item = carrinho[index];
            const novaQuantidade = item.quantidade + delta;
            
            if (novaQuantidade < 1) {
                removerDoCarrinho(index);
                return;
            }
            
            if (novaQuantidade > item.estoque) {
                mostrarAlerta('Quantidade excede o estoque disponível!', 'error');
                return;
            }
            
            item.quantidade = novaQuantidade;
            atualizarCarrinho();
        }
        
        function removerDoCarrinho(index) {
            const item = carrinho[index];
            carrinho.splice(index, 1);
            atualizarCarrinho();
            mostrarAlerta(`${item.nome} removido do carrinho`, 'warning');
        }
        
        function calcularTotalCarrinho() {
            const subtotal = carrinho.reduce((total, item) => 
                total + (item.preco * item.quantidade), 0);
            
            const desconto = parseFloat(document.getElementById('carrinhoDesconto').value) || 0;
            const total = Math.max(0, subtotal - desconto);
            
            document.getElementById('carrinhoSubtotal').textContent = 
                formatarMoeda(subtotal);
            document.getElementById('carrinhoTotal').textContent = 
                formatarMoeda(total);
            
            // Atualizar campo de valor recebido se for pagamento em dinheiro
            const valorRecebido = document.getElementById('valorRecebido');
            if (parseFloat(valorRecebido.value) > 0) {
                calcularTroco();
            }
        }
        
        function limparCarrinho() {
            carrinho = [];
            atualizarCarrinho();
            document.getElementById('carrinhoDesconto').value = '0';
            document.getElementById('clienteVenda').value = '';
            document.getElementById('valorRecebido').value = '';
            document.getElementById('valorTroco').value = '';
            document.getElementById('campoDinheiro').style.display = 'none';
            document.getElementById('campoCartao').style.display = 'none';
            
            // Resetar métodos de pagamento
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
            });
        }
        
        async function carregarClientesParaVenda() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "clientes"));
                
                clientes = [];
                querySnapshot.forEach((doc) => {
                    clientes.push({ id: doc.id, ...doc.data() });
                });
                
                const select = document.getElementById('clienteVenda');
                select.innerHTML = '<option value="">Cliente não identificado</option>';
                
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = `${cliente.nome}${cliente.cpf ? ` (${cliente.cpf})` : ''}`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error("Erro ao carregar clientes para venda:", error);
            }
        }
        
        function selecionarClienteVenda(clienteId) {
            if (clienteId) {
                const cliente = clientes.find(c => c.id === clienteId);
                if (cliente) {
                    mostrarAlerta(`Cliente ${cliente.nome} selecionado`, 'success');
                }
            }
        }
        
        function carregarMetodosPagamento() {
            const container = document.getElementById('paymentMethods');
            const metodos = [
                { id: 'dinheiro', nome: 'Dinheiro', icon: 'money-bill-wave' },
                { id: 'cartao_debito', nome: 'Cartão Débito', icon: 'credit-card' },
                { id: 'cartao_credito', nome: 'Cartão Crédito', icon: 'credit-card' },
                { id: 'pix', nome: 'PIX', icon: 'qrcode' },
                { id: 'vale_alimentacao', nome: 'Vale Alimentação', icon: 'utensils' },
                { id: 'vale_refeicao', nome: 'Vale Refeição', icon: 'utensils' }
            ];
            
            container.innerHTML = '';
            
            metodos.forEach(metodo => {
                const div = document.createElement('div');
                div.className = 'payment-method';
                div.setAttribute('data-method', metodo.id);
                div.onclick = () => selecionarFormaPagamento(metodo.id);
                
                div.innerHTML = `
                    <i class="fas fa-${metodo.icon}"></i>
                    <span>${metodo.nome}</span>
                `;
                
                container.appendChild(div);
            });
        }
        
        function selecionarFormaPagamento(forma) {
            // Remover seleção de todos os métodos
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
            });
            
            // Selecionar método atual
            const metodoElement = document.querySelector(`[data-method="${forma}"]`);
            if (metodoElement) {
                metodoElement.classList.add('active');
            }
            
            // Mostrar/ocultar campos específicos
            document.getElementById('campoDinheiro').style.display = 'none';
            document.getElementById('campoCartao').style.display = 'none';
            
            if (forma === 'dinheiro') {
                document.getElementById('campoDinheiro').style.display = 'block';
                calcularTroco();
            } else if (forma === 'cartao_debito' || forma === 'cartao_credito') {
                document.getElementById('campoCartao').style.display = 'block';
            }
        }
        
        function calcularTroco() {
            const totalText = document.getElementById('carrinhoTotal').textContent;
            const total = parseFloat(totalText.replace('R$', '').replace('.', '').replace(',', '.'));
            const recebido = parseFloat(document.getElementById('valorRecebido').value) || 0;
            
            if (recebido >= total) {
                const troco = recebido - total;
                document.getElementById('valorTroco').value = troco.toFixed(2);
            } else {
                document.getElementById('valorTroco').value = '0.00';
            }
        }
        
        async function finalizarVenda() {
            if (carrinho.length === 0) {
                mostrarAlerta('Adicione produtos ao carrinho antes de finalizar a venda', 'error');
                return;
            }
            
            // Verificar forma de pagamento selecionada
            const formaPagamentoElement = document.querySelector('.payment-method.active');
            if (!formaPagamentoElement) {
                mostrarAlerta('Selecione uma forma de pagamento', 'error');
                return;
            }
            
            const formaPagamento = formaPagamentoElement.getAttribute('data-method');
            const totalText = document.getElementById('carrinhoTotal').textContent;
            const total = parseFloat(totalText.replace('R$', '').replace('.', '').replace(',', '.'));
            const clienteId = document.getElementById('clienteVenda').value;
            const desconto = parseFloat(document.getElementById('carrinhoDesconto').value) || 0;
            
            const cliente = clienteId ? clientes.find(c => c.id === clienteId) : null;
            
            // Confirmar venda
            if (confirm(`Confirmar venda no valor de ${formatarMoeda(total)}?`)) {
                try {
                    const db = window.firebaseDb;
                    const vendaId = 'VENDA-' + Date.now();
                    
                    // Criar objeto da venda
                    const venda = {
                        id: vendaId,
                        data: new Date().toISOString(),
                        clienteId: clienteId,
                        clienteNome: cliente?.nome || 'Cliente não identificado',
                        clienteCPF: cliente?.cpf || '',
                        itens: carrinho.map(item => ({
                            produtoId: item.id,
                            codigo: item.codigo,
                            nome: item.nome,
                            quantidade: item.quantidade,
                            precoUnitario: item.preco,
                            subtotal: item.preco * item.quantidade
                        })),
                        subtotal: carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0),
                        desconto: desconto,
                        valorTotal: total,
                        formaPagamento: formaPagamento,
                        status: 'concluída',
                        vendedor: window.currentUser?.nome || window.currentUser?.email || 'Sistema',
                        dadosPagamento: {}
                    };
                    
                    // Adicionar dados específicos do pagamento
                    if (formaPagamento === 'dinheiro') {
                        venda.dadosPagamento = {
                            valorRecebido: parseFloat(document.getElementById('valorRecebido').value) || 0,
                            troco: parseFloat(document.getElementById('valorTroco').value) || 0
                        };
                    } else if (formaPagamento === 'cartao_debito' || formaPagamento === 'cartao_credito') {
                        venda.dadosPagamento = {
                            numeroCartao: document.getElementById('numeroCartao').value,
                            parcelas: parseInt(document.getElementById('parcelasCartao').value)
                        };
                    }
                    
                    // Salvar no Firebase
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "vendas"), venda);
                    
                    // Atualizar estoque dos produtos
                    for (const item of carrinho) {
                        const produtoRef = window.firebaseDoc(db, "produtos", item.id);
                        const produtoDoc = await window.firebaseGetDoc(produtoRef);
                        
                        if (produtoDoc.exists()) {
                            const produto = produtoDoc.data();
                            await window.firebaseUpdateDoc(produtoRef, {
                                estoque: produto.estoque - item.quantidade,
                                atualizadoEm: new Date().toISOString()
                            });
                            
                            // Atualizar localmente
                            const produtoLocal = produtos.find(p => p.id === item.id);
                            if (produtoLocal) {
                                produtoLocal.estoque -= item.quantidade;
                            }
                        }
                    }
                    
                    // Adicionar à lista local
                    vendas.push({ id: docRef.id, ...venda });
                    
                    // Atualizar histórico do cliente se houver
                    if (clienteId) {
                        const clienteRef = window.firebaseDoc(db, "clientes", clienteId);
                        await window.firebaseUpdateDoc(clienteRef, {
                            totalCompras: (cliente?.totalCompras || 0) + total,
                            ultimaCompra: new Date().toISOString(),
                            quantidadeCompras: (cliente?.quantidadeCompras || 0) + 1
                        });
                    }
                    
                    mostrarAlerta('Venda realizada com sucesso!', 'success');
                    
                    // Gerar comprovante
                    gerarComprovanteVenda(venda);
                    
                    // Limpar carrinho
                    limparCarrinho();
                    
                    // Atualizar estatísticas
                    carregarEstatisticasDashboard();
                    carregarProdutosParaCaixa();
                    
                } catch (error) {
                    console.error('Erro ao finalizar venda:', error);
                    mostrarAlerta('Erro ao processar venda: ' + error.message, 'error');
                }
            }
        }
        
        // ========== PRODUTOS ==========
        async function carregarProdutos() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "produtos"));
                
                produtos = [];
                querySnapshot.forEach((doc) => {
                    produtos.push({ id: doc.id, ...doc.data() });
                });
                
                atualizarTabelaProdutos();
                atualizarEstatisticasProdutos();
                
            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                mostrarAlerta("Erro ao carregar produtos", "error");
            }
        }
        
        function atualizarTabelaProdutos(filtrados = produtos) {
            const tbody = document.getElementById('tabelaProdutos');
            tbody.innerHTML = '';
            
            if (filtrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="table-empty">
                            <i class="fas fa-box-open"></i>
                            <p>Nenhum produto encontrado</p>
                            <button class="btn btn-primary" onclick="abrirModalProduto()">
                                <i class="fas fa-plus"></i> Cadastrar Primeiro Produto
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Paginação
            const totalPages = Math.ceil(filtrados.length / itemsPerPage);
            const startIndex = (currentPage.produtos - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const produtosPagina = filtrados.slice(startIndex, endIndex);
            
            produtosPagina.forEach(produto => {
                const status = produto.estoque > 0 ? 
                    `<span class="badge badge-success">Disponível</span>` :
                    `<span class="badge badge-danger">Sem Estoque</span>`;
                
                const margem = produto.precoCusto && produto.precoVenda ? 
                    ((produto.precoVenda - produto.precoCusto) / produto.precoVenda * 100).toFixed(1) : 0;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${produto.codigo || '-'}</td>
                    <td>
                        <div><strong>${produto.nome}</strong></div>
                        ${produto.descricao ? `<small>${produto.descricao.substring(0, 50)}...</small>` : ''}
                    </td>
                    <td><span class="badge badge-primary">${produto.categoria || 'Outros'}</span></td>
                    <td>${formatarMoeda(produto.precoCusto || 0)}</td>
                    <td>${formatarMoeda(produto.precoVenda || 0)}</td>
                    <td>
                        ${produto.estoque || 0}
                        ${produto.unidade ? `<small>${produto.unidade}</small>` : ''}
                    </td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarProduto('${produto.id}')" data-tooltip="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-xs" onclick="excluirProduto('${produto.id}')" data-tooltip="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar paginação
            atualizarPaginacao('produtos', totalPages);
        }
        
        function filtrarProdutosAdmin(termo) {
            const termoLower = termo.toLowerCase();
            const filtrados = produtos.filter(produto => 
                produto.nome.toLowerCase().includes(termoLower) ||
                produto.codigo?.toLowerCase().includes(termoLower) ||
                produto.categoria?.toLowerCase().includes(termoLower) ||
                produto.descricao?.toLowerCase().includes(termoLower)
            );
            
            currentPage.produtos = 1;
            atualizarTabelaProdutos(filtrados);
        }
        
        function filtrarProdutosPorCategoria(categoria) {
            if (!categoria) {
                atualizarTabelaProdutos(produtos);
                return;
            }
            
            const filtrados = produtos.filter(produto => 
                produto.categoria === categoria
            );
            
            currentPage.produtos = 1;
            atualizarTabelaProdutos(filtrados);
        }
        
        function filtrarProdutosPorEstoque(tipo) {
            let filtrados = [];
            
            switch(tipo) {
                case 'baixo':
                    filtrados = produtos.filter(p => p.estoque > 0 && p.estoque <= (p.estoqueMinimo || 5));
                    break;
                case 'normal':
                    filtrados = produtos.filter(p => p.estoque > (p.estoqueMinimo || 5));
                    break;
                case 'sem':
                    filtrados = produtos.filter(p => p.estoque <= 0);
                    break;
                default:
                    filtrados = produtos;
            }
            
            currentPage.produtos = 1;
            atualizarTabelaProdutos(filtrados);
        }
        
        async function salvarProduto(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const produtoId = document.getElementById('produtoId').value;
                
                const produtoData = {
                    codigo: document.getElementById('produtoCodigo').value.trim(),
                    nome: document.getElementById('produtoNome').value.trim(),
                    categoria: document.getElementById('produtoCategoria').value,
                    unidade: document.getElementById('produtoUnidade').value,
                    fornecedor: document.getElementById('produtoFornecedor').value.trim(),
                    localizacao: document.getElementById('produtoLocalizacao').value.trim(),
                    precoCusto: parseFloat(document.getElementById('produtoPrecoCusto').value) || 0,
                    precoVenda: parseFloat(document.getElementById('produtoPrecoVenda').value) || 0,
                    estoque: parseInt(document.getElementById('produtoEstoque').value) || 0,
                    estoqueMinimo: parseInt(document.getElementById('produtoEstoqueMinimo').value) || 5,
                    descricao: document.getElementById('produtoDescricao').value.trim(),
                    imagem: document.getElementById('produtoImagem').value.trim(),
                    atualizadoEm: new Date().toISOString()
                };
                
                // Adicionar dados de validade se controlar validade estiver marcado
                if (document.getElementById('produtoControlarValidade').checked) {
                    produtoData.controlarValidade = true;
                    produtoData.validade = document.getElementById('produtoValidade').value;
                    produtoData.diasAlerta = parseInt(document.getElementById('produtoDiasAlerta').value) || 30;
                }
                
                if (produtoId) {
                    // Atualizar produto existente
                    const produtoRef = window.firebaseDoc(db, "produtos", produtoId);
                    await window.firebaseUpdateDoc(produtoRef, produtoData);
                    
                    // Atualizar localmente
                    const index = produtos.findIndex(p => p.id === produtoId);
                    if (index !== -1) {
                        produtos[index] = { ...produtos[index], ...produtoData };
                    }
                    
                    mostrarAlerta("Produto atualizado com sucesso!", "success");
                } else {
                    // Criar novo produto
                    produtoData.criadoEm = new Date().toISOString();
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "produtos"), produtoData);
                    
                    // Adicionar localmente
                    produtos.push({ id: docRef.id, ...produtoData });
                    
                    mostrarAlerta("Produto cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalProduto');
                atualizarTabelaProdutos();
                atualizarEstatisticasProdutos();
                await carregarProdutosParaCaixa();
                
            } catch (error) {
                console.error("Erro ao salvar produto:", error);
                mostrarAlerta("Erro ao salvar produto: " + error.message, "error");
            }
        }
        
        async function editarProduto(id) {
            try {
                const db = window.firebaseDb;
                const produtoDoc = await window.firebaseGetDoc(window.firebaseDoc(db, "produtos", id));
                
                if (!produtoDoc.exists()) {
                    mostrarAlerta("Produto não encontrado", "error");
                    return;
                }
                
                const produto = produtoDoc.data();
                
                document.getElementById('modalProdutoTitulo').textContent = 'Editar Produto';
                document.getElementById('produtoId').value = id;
                document.getElementById('produtoCodigo').value = produto.codigo || '';
                document.getElementById('produtoNome').value = produto.nome || '';
                document.getElementById('produtoCategoria').value = produto.categoria || 'alimentos';
                document.getElementById('produtoUnidade').value = produto.unidade || 'un';
                document.getElementById('produtoFornecedor').value = produto.fornecedor || '';
                document.getElementById('produtoLocalizacao').value = produto.localizacao || '';
                document.getElementById('produtoPrecoCusto').value = produto.precoCusto || '';
                document.getElementById('produtoPrecoVenda').value = produto.precoVenda || '';
                document.getElementById('produtoEstoque').value = produto.estoque || 0;
                document.getElementById('produtoEstoqueMinimo').value = produto.estoqueMinimo || 5;
                document.getElementById('produtoDescricao').value = produto.descricao || '';
                document.getElementById('produtoImagem').value = produto.imagem || '';
                
                // Controle de validade
                if (produto.controlarValidade) {
                    document.getElementById('produtoControlarValidade').checked = true;
                    document.getElementById('validadeContainer').style.display = 'block';
                    document.getElementById('produtoValidade').value = produto.validade || '';
                    document.getElementById('produtoDiasAlerta').value = produto.diasAlerta || 30;
                }
                
                calcularMargem();
                abrirModal('modalProduto');
                
            } catch (error) {
                console.error("Erro ao carregar produto para edição:", error);
                mostrarAlerta("Erro ao carregar produto", "error");
            }
        }
        
        async function excluirProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto? Esta ação não pode ser desfeita.')) {
                try {
                    const db = window.firebaseDb;
                    await window.firebaseDeleteDoc(window.firebaseDoc(db, "produtos", id));
                    
                    // Remover localmente
                    const index = produtos.findIndex(p => p.id === id);
                    if (index !== -1) {
                        produtos.splice(index, 1);
                    }
                    
                    mostrarAlerta("Produto excluído com sucesso!", "success");
                    atualizarTabelaProdutos();
                    atualizarEstatisticasProdutos();
                    await carregarProdutosParaCaixa();
                    
                } catch (error) {
                    console.error("Erro ao excluir produto:", error);
                    mostrarAlerta("Erro ao excluir produto", "error");
                }
            }
        }
        
        async function reporEstoque(id) {
            const quantidade = prompt('Quantidade a adicionar ao estoque:');
            if (quantidade && !isNaN(quantidade) && parseInt(quantidade) > 0) {
                try {
                    const db = window.firebaseDb;
                    const produtoRef = window.firebaseDoc(db, "produtos", id);
                    const produtoDoc = await window.firebaseGetDoc(produtoRef);
                    
                    if (produtoDoc.exists()) {
                        const produto = produtoDoc.data();
                        const novoEstoque = (produto.estoque || 0) + parseInt(quantidade);
                        
                        await window.firebaseUpdateDoc(produtoRef, {
                            estoque: novoEstoque,
                            atualizadoEm: new Date().toISOString()
                        });
                        
                        // Atualizar localmente
                        const produtoLocal = produtos.find(p => p.id === id);
                        if (produtoLocal) {
                            produtoLocal.estoque = novoEstoque;
                        }
                        
                        mostrarAlerta(`Estoque reposto em ${quantidade} unidades`, "success");
                        atualizarTabelaProdutos();
                        carregarProdutosEstoqueBaixo();
                        await carregarProdutosParaCaixa();
                    }
                } catch (error) {
                    console.error("Erro ao repor estoque:", error);
                    mostrarAlerta("Erro ao repor estoque", "error");
                }
            }
        }
        
        function atualizarEstatisticasProdutos() {
            const totalProdutos = produtos.length;
            const valorTotalEstoque = produtos.reduce((total, produto) => 
                total + ((produto.precoCusto || 0) * (produto.estoque || 0)), 0);
            const produtosSemEstoque = produtos.filter(p => (p.estoque || 0) <= 0).length;
            
            // Encontrar categoria com mais produtos
            const categorias = {};
            produtos.forEach(p => {
                const categoria = p.categoria || 'Outros';
                categorias[categoria] = (categorias[categoria] || 0) + 1;
            });
            
            let categoriaMaisProdutos = 'Nenhuma';
            let maxCount = 0;
            for (const [categoria, count] of Object.entries(categorias)) {
                if (count > maxCount) {
                    maxCount = count;
                    categoriaMaisProdutos = categoria;
                }
            }
            
            document.getElementById('totalProdutosCadastrados').textContent = totalProdutos;
            document.getElementById('valorTotalEstoque').textContent = formatarMoeda(valorTotalEstoque);
            document.getElementById('produtosSemEstoqueCount').textContent = produtosSemEstoque;
            document.getElementById('categoriaMaisProdutos').textContent = categoriaMaisProdutos;
        }
        
        function gerarRelatorioProdutos() {
            mostrarAlerta("Gerando relatório de produtos...", "info");
            // Em produção, geraria um relatório em PDF ou Excel
        }
        
        function exportarProdutos() {
            try {
                const ws = XLSX.utils.json_to_sheet(produtos.map(p => ({
                    Código: p.codigo || '',
                    Nome: p.nome || '',
                    Categoria: p.categoria || '',
                    'Preço Custo': p.precoCusto || 0,
                    'Preço Venda': p.precoVenda || 0,
                    Estoque: p.estoque || 0,
                    'Estoque Mínimo': p.estoqueMinimo || 5,
                    Fornecedor: p.fornecedor || '',
                    Descrição: p.descricao || ''
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Produtos");
                XLSX.writeFile(wb, `produtos_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                mostrarAlerta("Produtos exportados com sucesso!", "success");
            } catch (error) {
                console.error("Erro ao exportar produtos:", error);
                mostrarAlerta("Erro ao exportar produtos", "error");
            }
        }
        
        // ========== CLIENTES ==========
        async function carregarClientes() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "clientes"));
                
                clientes = [];
                querySnapshot.forEach((doc) => {
                    clientes.push({ id: doc.id, ...doc.data() });
                });
                
                atualizarTabelaClientes();
                criarGraficoClientes();
                
            } catch (error) {
                console.error("Erro ao carregar clientes:", error);
                mostrarAlerta("Erro ao carregar clientes", "error");
            }
        }
        
        function atualizarTabelaClientes(filtrados = clientes) {
            const tbody = document.getElementById('tabelaClientes');
            tbody.innerHTML = '';
            
            if (filtrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="table-empty">
                            <i class="fas fa-users"></i>
                            <p>Nenhum cliente encontrado</p>
                            <button class="btn btn-primary" onclick="abrirModalCliente()">
                                <i class="fas fa-user-plus"></i> Cadastrar Primeiro Cliente
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Paginação
            const totalPages = Math.ceil(filtrados.length / itemsPerPage);
            const startIndex = (currentPage.clientes - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const clientesPagina = filtrados.slice(startIndex, endIndex);
            
            clientesPagina.forEach(cliente => {
                const tipoCliente = cliente.tipo === 'vip' ? 
                    `<span class="badge badge-warning">VIP</span>` :
                    cliente.tipo === 'fidelizado' ?
                    `<span class="badge badge-success">FIDELIZADO</span>` :
                    cliente.tipo === 'corporativo' ?
                    `<span class="badge badge-info">CORPORATIVO</span>` :
                    `<span class="badge badge-primary">NORMAL</span>`;
                
                const ultimaCompra = cliente.ultimaCompra ? 
                    new Date(cliente.ultimaCompra).toLocaleDateString('pt-BR') : 
                    'Nenhuma compra';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div><strong>${cliente.nome}</strong></div>
                        ${cliente.email ? `<small>${cliente.email}</small>` : ''}
                    </td>
                    <td>${cliente.cpf || 'Não informado'}</td>
                    <td>${cliente.telefone}</td>
                    <td>${cliente.email || 'Não informado'}</td>
                    <td>${tipoCliente}</td>
                    <td>${formatarMoeda(cliente.totalCompras || 0)}</td>
                    <td>${ultimaCompra}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarCliente('${cliente.id}')" data-tooltip="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-info btn-xs" onclick="verHistoricoCliente('${cliente.id}')" data-tooltip="Histórico">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar paginação
            atualizarPaginacao('clientes', totalPages);
            
            // Atualizar estatísticas
            document.getElementById('totalClientesConfig').textContent = clientes.length;
        }
        
        function filtrarClientes(termo) {
            const termoLower = termo.toLowerCase();
            const filtrados = clientes.filter(cliente => 
                cliente.nome.toLowerCase().includes(termoLower) ||
                cliente.cpf?.toLowerCase().includes(termoLower) ||
                cliente.telefone?.toLowerCase().includes(termoLower) ||
                cliente.email?.toLowerCase().includes(termoLower)
            );
            
            currentPage.clientes = 1;
            atualizarTabelaClientes(filtrados);
        }
        
        async function salvarCliente(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const clienteId = document.getElementById('clienteId').value;
                
                const clienteData = {
                    nome: document.getElementById('clienteNome').value.trim(),
                    cpf: document.getElementById('clienteCPF').value.trim(),
                    telefone: document.getElementById('clienteTelefone').value.trim(),
                    email: document.getElementById('clienteEmail').value.trim().toLowerCase(),
                    endereco: document.getElementById('clienteEndereco').value.trim(),
                    nascimento: document.getElementById('clienteNascimento').value,
                    tipo: document.getElementById('clienteTipo').value,
                    observacoes: document.getElementById('clienteObservacoes').value.trim(),
                    atualizadoEm: new Date().toISOString()
                };
                
                if (clienteId) {
                    // Atualizar cliente existente
                    const clienteRef = window.firebaseDoc(db, "clientes", clienteId);
                    await window.firebaseUpdateDoc(clienteRef, clienteData);
                    
                    // Atualizar localmente
                    const index = clientes.findIndex(c => c.id === clienteId);
                    if (index !== -1) {
                        clientes[index] = { ...clientes[index], ...clienteData };
                    }
                    
                    mostrarAlerta("Cliente atualizado com sucesso!", "success");
                } else {
                    // Criar novo cliente
                    clienteData.dataCadastro = new Date().toISOString();
                    clienteData.totalCompras = 0;
                    clienteData.quantidadeCompras = 0;
                    
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "clientes"), clienteData);
                    
                    // Adicionar localmente
                    clientes.push({ id: docRef.id, ...clienteData });
                    
                    mostrarAlerta("Cliente cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalCliente');
                atualizarTabelaClientes();
                carregarClientesParaVenda();
                
            } catch (error) {
                console.error("Erro ao salvar cliente:", error);
                mostrarAlerta("Erro ao salvar cliente: " + error.message, "error");
            }
        }
        
        async function editarCliente(id) {
            try {
                const db = window.firebaseDb;
                const clienteDoc = await window.firebaseGetDoc(window.firebaseDoc(db, "clientes", id));
                
                if (!clienteDoc.exists()) {
                    mostrarAlerta("Cliente não encontrado", "error");
                    return;
                }
                
                const cliente = clienteDoc.data();
                
                document.getElementById('modalClienteTitulo').textContent = 'Editar Cliente';
                document.getElementById('clienteId').value = id;
                document.getElementById('clienteNome').value = cliente.nome || '';
                document.getElementById('clienteCPF').value = cliente.cpf || '';
                document.getElementById('clienteTelefone').value = cliente.telefone || '';
                document.getElementById('clienteEmail').value = cliente.email || '';
                document.getElementById('clienteEndereco').value = cliente.endereco || '';
                document.getElementById('clienteNascimento').value = cliente.nascimento || '';
                document.getElementById('clienteTipo').value = cliente.tipo || 'normal';
                document.getElementById('clienteObservacoes').value = cliente.observacoes || '';
                
                abrirModal('modalCliente');
                
            } catch (error) {
                console.error("Erro ao carregar cliente para edição:", error);
                mostrarAlerta("Erro ao carregar cliente", "error");
            }
        }
        
        function verHistoricoCliente(clienteId) {
            const cliente = clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            
            // Filtrar vendas do cliente
            const vendasCliente = vendas.filter(v => v.clienteId === clienteId);
            
            let historicoHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary);">Histórico de Compras</h4>
                    <p><strong>Cliente:</strong> ${cliente.nome}</p>
                    <p><strong>Total de Compras:</strong> ${cliente.quantidadeCompras || 0}</p>
                    <p><strong>Valor Total Gasto:</strong> ${formatarMoeda(cliente.totalCompras || 0)}</p>
                </div>
            `;
            
            if (vendasCliente.length === 0) {
                historicoHTML += `<p style="color: var(--gray); text-align: center; padding: 20px;">Nenhuma compra registrada</p>`;
            } else {
                historicoHTML += `
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Valor</th>
                                    <th>Produtos</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                vendasCliente.forEach(venda => {
                    historicoHTML += `
                        <tr>
                            <td>${new Date(venda.data).toLocaleDateString('pt-BR')}</td>
                            <td>${formatarMoeda(venda.valorTotal)}</td>
                            <td>${venda.itens.length} produtos</td>
                        </tr>
                    `;
                });
                
                historicoHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            document.getElementById('vendaDetalhes').innerHTML = historicoHTML;
            abrirModal('modalVenda');
        }
        
        function criarGraficoClientes() {
            const ctx = document.getElementById('graficoClientes').getContext('2d');
            
            if (graficoClientes) {
                graficoClientes.destroy();
            }
            
            // Dados de exemplo
            const labels = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const data = [15, 22, 18, 25, 30, 28];
            
            graficoClientes = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Novos Clientes',
                        data: data,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: '#3498db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoClientes(periodo) {
            mostrarAlerta(`Gráfico atualizado para período ${periodo}`, "info");
        }
        
        function exportarClientes() {
            try {
                const ws = XLSX.utils.json_to_sheet(clientes.map(c => ({
                    Nome: c.nome || '',
                    CPF: c.cpf || '',
                    Telefone: c.telefone || '',
                    Email: c.email || '',
                    Tipo: c.tipo || 'normal',
                    'Total Compras': c.totalCompras || 0,
                    'Última Compra': c.ultimaCompra ? new Date(c.ultimaCompra).toLocaleDateString('pt-BR') : '',
                    Endereço: c.endereco || '',
                    'Data Cadastro': c.dataCadastro ? new Date(c.dataCadastro).toLocaleDateString('pt-BR') : ''
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Clientes");
                XLSX.writeFile(wb, `clientes_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                mostrarAlerta("Clientes exportados com sucesso!", "success");
            } catch (error) {
                console.error("Erro ao exportar clientes:", error);
                mostrarAlerta("Erro ao exportar clientes", "error");
            }
        }
        
        // ========== FUNCIONÁRIOS ==========
        async function carregarFuncionarios() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(window.firebaseCollection(db, "funcionarios"));
                
                funcionarios = [];
                querySnapshot.forEach((doc) => {
                    funcionarios.push({ id: doc.id, ...doc.data() });
                });
                
                atualizarTabelaFuncionarios();
                
            } catch (error) {
                console.error("Erro ao carregar funcionários:", error);
                mostrarAlerta("Erro ao carregar funcionários", "error");
            }
        }
        
        function atualizarTabelaFuncionarios(filtrados = funcionarios) {
            const tbody = document.getElementById('tabelaFuncionarios');
            tbody.innerHTML = '';
            
            if (filtrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="table-empty">
                            <i class="fas fa-user-tie"></i>
                            <p>Nenhum funcionário encontrado</p>
                            <button class="btn btn-primary" onclick="abrirModalFuncionario()">
                                <i class="fas fa-user-plus"></i> Cadastrar Primeiro Funcionário
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Paginação
            const totalPages = Math.ceil(filtrados.length / itemsPerPage);
            const startIndex = (currentPage.funcionarios - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const funcionariosPagina = filtrados.slice(startIndex, endIndex);
            
            funcionariosPagina.forEach(funcionario => {
                const status = funcionario.status === 'ativo' ? 
                    `<span class="badge badge-success">ATIVO</span>` :
                    funcionario.status === 'ferias' ?
                    `<span class="badge badge-warning">FÉRIAS</span>` :
                    `<span class="badge badge-danger">${funcionario.status.toUpperCase()}</span>`;
                
                const cargo = funcionario.cargo === 'gerente' ? 
                    `<span class="badge badge-warning">GERENTE</span>` :
                    funcionario.cargo === 'caixa' ?
                    `<span class="badge badge-primary">CAIXA</span>` :
                    funcionario.cargo === 'supervisor' ?
                    `<span class="badge badge-info">SUPERVISOR</span>` :
                    `<span class="badge badge-secondary">${funcionario.cargo?.toUpperCase() || 'OUTRO'}</span>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div><strong>${funcionario.nome}</strong></div>
                        ${funcionario.email ? `<small>${funcionario.email}</small>` : ''}
                    </td>
                    <td>${cargo}</td>
                    <td>${funcionario.cpf || ''}</td>
                    <td>${funcionario.telefone}</td>
                    <td>${formatarMoeda(funcionario.salario || 0)}</td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-xs" onclick="editarFuncionario('${funcionario.id}')" data-tooltip="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-xs" onclick="excluirFuncionario('${funcionario.id}')" data-tooltip="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar paginação
            atualizarPaginacao('funcionarios', totalPages);
        }
        
        function filtrarFuncionarios(termo) {
            const termoLower = termo.toLowerCase();
            const filtrados = funcionarios.filter(funcionario => 
                funcionario.nome.toLowerCase().includes(termoLower) ||
                funcionario.cargo?.toLowerCase().includes(termoLower) ||
                funcionario.cpf?.toLowerCase().includes(termoLower) ||
                funcionario.email?.toLowerCase().includes(termoLower)
            );
            
            currentPage.funcionarios = 1;
            atualizarTabelaFuncionarios(filtrados);
        }
        
        async function salvarFuncionario(e) {
            e.preventDefault();
            
            try {
                const db = window.firebaseDb;
                const funcionarioId = document.getElementById('funcionarioId').value;
                
                const funcionarioData = {
                    nome: document.getElementById('funcionarioNome').value.trim(),
                    cpf: document.getElementById('funcionarioCPF').value.trim(),
                    cargo: document.getElementById('funcionarioCargo').value,
                    salario: parseFloat(document.getElementById('funcionarioSalario').value) || 0,
                    telefone: document.getElementById('funcionarioTelefone').value.trim(),
                    email: document.getElementById('funcionarioEmail').value.trim().toLowerCase(),
                    endereco: document.getElementById('funcionarioEndereco').value.trim(),
                    admissao: document.getElementById('funcionarioAdmissao').value,
                    status: document.getElementById('funcionarioStatus').value,
                    turno: document.getElementById('funcionarioTurno').value,
                    comissao: parseFloat(document.getElementById('funcionarioComissao').value) || 0,
                    observacoes: document.getElementById('funcionarioObservacoes').value.trim(),
                    atualizadoEm: new Date().toISOString()
                };
                
                if (funcionarioId) {
                    // Atualizar funcionário existente
                    const funcionarioRef = window.firebaseDoc(db, "funcionarios", funcionarioId);
                    await window.firebaseUpdateDoc(funcionarioRef, funcionarioData);
                    
                    // Atualizar localmente
                    const index = funcionarios.findIndex(f => f.id === funcionarioId);
                    if (index !== -1) {
                        funcionarios[index] = { ...funcionarios[index], ...funcionarioData };
                    }
                    
                    mostrarAlerta("Funcionário atualizado com sucesso!", "success");
                } else {
                    // Criar novo funcionário
                    funcionarioData.dataCadastro = new Date().toISOString();
                    
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(db, "funcionarios"), funcionarioData);
                    
                    // Adicionar localmente
                    funcionarios.push({ id: docRef.id, ...funcionarioData });
                    
                    mostrarAlerta("Funcionário cadastrado com sucesso!", "success");
                }
                
                fecharModal('modalFuncionario');
                atualizarTabelaFuncionarios();
                
            } catch (error) {
                console.error("Erro ao salvar funcionário:", error);
                mostrarAlerta("Erro ao salvar funcionário: " + error.message, "error");
            }
        }
        
        async function editarFuncionario(id) {
            try {
                const db = window.firebaseDb;
                const funcionarioDoc = await window.firebaseGetDoc(window.firebaseDoc(db, "funcionarios", id));
                
                if (!funcionarioDoc.exists()) {
                    mostrarAlerta("Funcionário não encontrado", "error");
                    return;
                }
                
                const funcionario = funcionarioDoc.data();
                
                document.getElementById('modalFuncionarioTitulo').textContent = 'Editar Funcionário';
                document.getElementById('funcionarioId').value = id;
                document.getElementById('funcionarioNome').value = funcionario.nome || '';
                document.getElementById('funcionarioCPF').value = funcionario.cpf || '';
                document.getElementById('funcionarioCargo').value = funcionario.cargo || '';
                document.getElementById('funcionarioSalario').value = funcionario.salario || '';
                document.getElementById('funcionarioTelefone').value = funcionario.telefone || '';
                document.getElementById('funcionarioEmail').value = funcionario.email || '';
                document.getElementById('funcionarioEndereco').value = funcionario.endereco || '';
                document.getElementById('funcionarioAdmissao').value = funcionario.admissao || '';
                document.getElementById('funcionarioStatus').value = funcionario.status || 'ativo';
                document.getElementById('funcionarioTurno').value = funcionario.turno || '';
                document.getElementById('funcionarioComissao').value = funcionario.comissao || 0;
                document.getElementById('funcionarioObservacoes').value = funcionario.observacoes || '';
                
                abrirModal('modalFuncionario');
                
            } catch (error) {
                console.error("Erro ao carregar funcionário para edição:", error);
                mostrarAlerta("Erro ao carregar funcionário", "error");
            }
        }
        
        async function excluirFuncionario(id) {
            if (confirm('Tem certeza que deseja excluir este funcionário? Esta ação não pode ser desfeita.')) {
                try {
                    const db = window.firebaseDb;
                    await window.firebaseDeleteDoc(window.firebaseDoc(db, "funcionarios", id));
                    
                    // Remover localmente
                    const index = funcionarios.findIndex(f => f.id === id);
                    if (index !== -1) {
                        funcionarios.splice(index, 1);
                    }
                    
                    mostrarAlerta("Funcionário excluído com sucesso!", "success");
                    atualizarTabelaFuncionarios();
                    
                } catch (error) {
                    console.error("Erro ao excluir funcionário:", error);
                    mostrarAlerta("Erro ao excluir funcionário", "error");
                }
            }
        }
        
        function exportarFuncionarios() {
            try {
                const ws = XLSX.utils.json_to_sheet(funcionarios.map(f => ({
                    Nome: f.nome || '',
                    CPF: f.cpf || '',
                    Cargo: f.cargo || '',
                    Telefone: f.telefone || '',
                    Email: f.email || '',
                    Salário: f.salario || 0,
                    Status: f.status || '',
                    'Data Admissão': f.admissao || '',
                    Turno: f.turno || '',
                    Comissão: f.comissao || 0,
                    Endereço: f.endereco || ''
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Funcionários");
                XLSX.writeFile(wb, `funcionarios_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                mostrarAlerta("Funcionários exportados com sucesso!", "success");
            } catch (error) {
                console.error("Erro ao exportar funcionários:", error);
                mostrarAlerta("Erro ao exportar funcionários", "error");
            }
        }
        
        // ========== VENDAS ==========
        async function carregarVendas() {
            try {
                const db = window.firebaseDb;
                const querySnapshot = await window.firebaseGetDocs(
                    window.firebaseQuery(
                        window.firebaseCollection(db, "vendas"),
                        window.firebaseOrderBy("data", "desc")
                    )
                );
                
                vendas = [];
                querySnapshot.forEach((doc) => {
                    vendas.push({ id: doc.id, ...doc.data() });
                });
                
                atualizarTabelaVendas();
                document.getElementById('totalVendasConfig').textContent = vendas.length;
                
            } catch (error) {
                console.error("Erro ao carregar vendas:", error);
                mostrarAlerta("Erro ao carregar vendas", "error");
            }
        }
        
        function atualizarTabelaVendas(filtradas = vendas) {
            const tbody = document.getElementById('tabelaVendas');
            tbody.innerHTML = '';
            
            if (filtradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="table-empty">
                            <i class="fas fa-receipt"></i>
                            <p>Nenhuma venda encontrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Paginação
            const totalPages = Math.ceil(filtradas.length / itemsPerPage);
            const startIndex = (currentPage.vendas - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const vendasPagina = filtradas.slice(startIndex, endIndex);
            
            vendasPagina.forEach(venda => {
                const produtosLista = venda.itens.slice(0, 2).map(item => 
                    `${item.quantidade}x ${item.nome}`
                ).join(', ');
                
                const maisItens = venda.itens.length > 2 ? ` e +${venda.itens.length - 2}` : '';
                
                const status = venda.status === 'concluída' ? 
                    `<span class="badge badge-success">CONCLUÍDA</span>` :
                    venda.status === 'cancelada' ?
                    `<span class="badge badge-danger">CANCELADA</span>` :
                    `<span class="badge badge-warning">${venda.status.toUpperCase()}</span>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${venda.id.substring(0, 8)}</td>
                    <td>${new Date(venda.data).toLocaleString('pt-BR')}</td>
                    <td>${venda.clienteNome}</td>
                    <td>${produtosLista}${maisItens}</td>
                    <td>${formatarMoeda(venda.valorTotal)}</td>
                    <td>${venda.formaPagamento}</td>
                    <td>${status}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-info btn-xs" onclick="verDetalhesVenda('${venda.id}')" data-tooltip="Ver Detalhes">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-warning btn-xs" onclick="solicitarCancelamentoVenda('${venda.id}')" 
                                    ${venda.status === 'concluída' ? '' : 'disabled'} data-tooltip="Cancelar Venda">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar paginação
            atualizarPaginacao('vendas', totalPages);
        }
        
        function filtrarVendas() {
            const dataInicio = document.getElementById('dataInicioVendas').value;
            const dataFim = document.getElementById('dataFimVendas').value;
            const status = document.getElementById('filtroStatusVenda').value;
            
            let filtradas = vendas;
            
            // Filtrar por data
            if (dataInicio) {
                const inicio = new Date(dataInicio);
                inicio.setHours(0, 0, 0, 0);
                filtradas = filtradas.filter(v => new Date(v.data) >= inicio);
            }
            
            if (dataFim) {
                const fim = new Date(dataFim);
                fim.setHours(23, 59, 59, 999);
                filtradas = filtradas.filter(v => new Date(v.data) <= fim);
            }
            
            // Filtrar por status
            if (status) {
                filtradas = filtradas.filter(v => v.status === status);
            }
            
            currentPage.vendas = 1;
            atualizarTabelaVendas(filtradas);
        }
        
        async function verDetalhesVenda(vendaId) {
            try {
                const db = window.firebaseDb;
                const vendaDoc = await window.firebaseGetDoc(window.firebaseDoc(db, "vendas", vendaId));
                
                if (!vendaDoc.exists()) {
                    mostrarAlerta("Venda não encontrada", "error");
                    return;
                }
                
                const venda = vendaDoc.data();
                
                let detalhesHTML = `
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Informações da Venda</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <p><strong>ID:</strong> ${vendaId}</p>
                                <p><strong>Data/Hora:</strong> ${new Date(venda.data).toLocaleString('pt-BR')}</p>
                                <p><strong>Cliente:</strong> ${venda.clienteNome}</p>
                                ${venda.clienteCPF ? `<p><strong>CPF:</strong> ${venda.clienteCPF}</p>` : ''}
                            </div>
                            <div>
                                <p><strong>Vendedor:</strong> ${venda.vendedor}</p>
                                <p><strong>Forma de Pagamento:</strong> ${venda.formaPagamento}</p>
                                <p><strong>Status:</strong> ${venda.status}</p>
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="color: var(--primary); margin-bottom: 15px;">Produtos</h4>
                    <div class="table-container" style="margin-bottom: 25px;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Preço Unitário</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                venda.itens.forEach(item => {
                    detalhesHTML += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.quantidade}</td>
                            <td>${formatarMoeda(item.precoUnitario)}</td>
                            <td>${formatarMoeda(item.subtotal)}</td>
                        </tr>
                    `;
                });
                
                detalhesHTML += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Subtotal:</span>
                            <span>${formatarMoeda(venda.subtotal)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Desconto:</span>
                            <span>${formatarMoeda(venda.desconto)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; border-top: 2px solid #e0e6ed; padding-top: 10px;">
                            <span>TOTAL:</span>
                            <span>${formatarMoeda(venda.valorTotal)}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('vendaDetalhes').innerHTML = detalhesHTML;
                abrirModal('modalVenda');
                
            } catch (error) {
                console.error("Erro ao carregar detalhes da venda:", error);
                mostrarAlerta("Erro ao carregar detalhes da venda", "error");
            }
        }
        
        function solicitarCancelamentoVenda(vendaId) {
            const motivo = prompt('Motivo do cancelamento:');
            if (!motivo) return;
            
            mostrarAlerta('Solicitação de cancelamento enviada para aprovação', 'warning');
        }
        
        async function carregarCancelamentos() {
            // Em produção, carregaria do Firebase
            const tbody = document.getElementById('tabelaCancelamentos');
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="table-empty">
                        <i class="fas fa-check-circle"></i>
                        <p>Nenhuma solicitação de cancelamento pendente</p>
                    </td>
                </tr>
            `;
        }
        
        function exportarVendas() {
            try {
                const ws = XLSX.utils.json_to_sheet(vendas.map(v => ({
                    ID: v.id,
                    Data: new Date(v.data).toLocaleString('pt-BR'),
                    Cliente: v.clienteNome || '',
                    'CPF Cliente': v.clienteCPF || '',
                    'Quantidade Itens': v.itens.length,
                    Subtotal: v.subtotal || 0,
                    Desconto: v.desconto || 0,
                    Total: v.valorTotal || 0,
                    'Forma Pagamento': v.formaPagamento || '',
                    Vendedor: v.vendedor || '',
                    Status: v.status || ''
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Vendas");
                XLSX.writeFile(wb, `vendas_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                mostrarAlerta("Vendas exportadas com sucesso!", "success");
            } catch (error) {
                console.error("Erro ao exportar vendas:", error);
                mostrarAlerta("Erro ao exportar vendas", "error");
            }
        }
        
        // ========== PAGINAÇÃO ==========
        function atualizarPaginacao(tipo, totalPages) {
            const container = document.getElementById(`pagination${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Botão anterior
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage[tipo] === 1;
            prevBtn.onclick = () => {
                if (currentPage[tipo] > 1) {
                    currentPage[tipo]--;
                    switch(tipo) {
                        case 'produtos': atualizarTabelaProdutos(); break;
                        case 'clientes': atualizarTabelaClientes(); break;
                        case 'funcionarios': atualizarTabelaFuncionarios(); break;
                        case 'vendas': atualizarTabelaVendas(); break;
                    }
                }
            };
            container.appendChild(prevBtn);
            
            // Números das páginas
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage[tipo] ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage[tipo] = i;
                    switch(tipo) {
                        case 'produtos': atualizarTabelaProdutos(); break;
                        case 'clientes': atualizarTabelaClientes(); break;
                        case 'funcionarios': atualizarTabelaFuncionarios(); break;
                        case 'vendas': atualizarTabelaVendas(); break;
                    }
                };
                container.appendChild(pageBtn);
            }
            
            // Botão próximo
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage[tipo] === totalPages;
            nextBtn.onclick = () => {
                if (currentPage[tipo] < totalPages) {
                    currentPage[tipo]++;
                    switch(tipo) {
                        case 'produtos': atualizarTabelaProdutos(); break;
                        case 'clientes': atualizarTabelaClientes(); break;
                        case 'funcionarios': atualizarTabelaFuncionarios(); break;
                        case 'vendas': atualizarTabelaVendas(); break;
                    }
                }
            };
            container.appendChild(nextBtn);
        }
        
        // ========== COMPROVANTE ==========
        function gerarComprovanteVenda(venda) {
            // Atualizar informações da loja no comprovante
            document.getElementById('comprovanteNomeLoja').textContent = 
                configuracoes.nomeLoja || 'SUPERMERCADO PRO';
            document.getElementById('comprovanteEndereco').textContent = 
                configuracoes.endereco || 'Endereço não configurado';
            document.getElementById('comprovanteTelefone').textContent = 
                configuracoes.telefone || 'Telefone não configurado';
            document.getElementById('comprovanteCNPJ').textContent = 
                `CNPJ: ${configuracoes.cnpj || 'Não informado'}`;
            document.getElementById('comprovanteData').textContent = 
                `Data: ${new Date(venda.data).toLocaleString('pt-BR')}`;
            document.getElementById('comprovanteVenda').textContent = 
                `Venda: ${venda.id.substring(0, 8)}`;
            document.getElementById('comprovanteVendedor').textContent = 
                `Vendedor: ${venda.vendedor}`;
            
            // Adicionar itens
            const itemsContainer = document.getElementById('comprovanteItems');
            itemsContainer.innerHTML = '';
            
            venda.itens.forEach(item => {
                const div = document.createElement('div');
                div.className = 'comprovante-item';
                div.innerHTML = `
                    <div class="comprovante-item-desc">
                        <div>${item.nome}</div>
                        <small class="comprovante-item-qtd">${item.quantidade} x ${formatarMoeda(item.precoUnitario)}</small>
                    </div>
                    <div>${formatarMoeda(item.subtotal)}</div>
                `;
                itemsContainer.appendChild(div);
            });
            
            // Adicionar totais
            const totalDiv = document.createElement('div');
            totalDiv.className = 'comprovante-item';
            totalDiv.innerHTML = `
                <div>DESCONTO</div>
                <div>${formatarMoeda(venda.desconto)}</div>
            `;
            itemsContainer.appendChild(totalDiv);
            
            // Atualizar total
            document.getElementById('comprovanteTotal').textContent = 
                formatarMoeda(venda.valorTotal);
            
            // Mostrar modal
            abrirModal('modalComprovante');
        }
        
        function imprimirComprovante() {
            const comprovante = document.getElementById('comprovantePreview');
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Comprovante de Venda</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
                            .comprovante-preview { max-width: 80mm; margin: 0 auto; }
                            .comprovante-header { text-align: center; margin-bottom: 15px; }
                            .comprovante-title { font-size: 16px; font-weight: bold; }
                            .comprovante-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
                            .comprovante-item-desc { flex: 1; }
                            .comprovante-item-qtd { color: #666; }
                            .comprovante-total { display: flex; justify-content: space-between; font-weight: bold; margin-top: 15px; padding-top: 10px; border-top: 2px dashed #000; }
                            @media print {
                                body { margin: 0; }
                                button { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        ${comprovante.innerHTML}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(() => window.close(), 1000);
                            };
                        </script>
                    </body>
                </html>
            `);
            
            printWindow.document.close();
        }
        
        async function salvarComprovante() {
            try {
                const comprovante = document.getElementById('comprovantePreview');
                
                // Usar html2canvas para capturar como imagem
                const canvas = await html2canvas(comprovante);
                
                // Converter para PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const pageHeight = pdf.internal.pageSize.height;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 10;
                
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`comprovante-${Date.now()}.pdf`);
                mostrarAlerta('Comprovante salvo como PDF!', 'success');
                
            } catch (error) {
                console.error('Erro ao salvar comprovante:', error);
                mostrarAlerta('Erro ao salvar comprovante', 'error');
            }
        }
        
        // ========== RELATÓRIOS ==========
        function gerarRelatorioTipo(tipo) {
            mostrarAlerta(`Gerando relatório de ${tipo}...`, "info");
            // Em produção, geraria um relatório em PDF ou Excel
        }
        
        function gerarRelatorioCompleto() {
            mostrarAlerta("Gerando relatório completo em PDF...", "info");
            // Em produção, geraria um PDF completo
        }
        
        function exportarDados(tipo) {
            mostrarAlerta(`Exportando dados de ${tipo}...`, "info");
            // Implementação específica para cada tipo
            switch(tipo) {
                case 'produtos':
                    exportarProdutos();
                    break;
                case 'clientes':
                    exportarClientes();
                    break;
                case 'vendas':
                    exportarVendas();
                    break;
                case 'funcionarios':
                    exportarFuncionarios();
                    break;
            }
        }
        
        function exportarTodosDados() {
            mostrarAlerta("Exportando todos os dados...", "info");
            // Em produção, geraria um arquivo Excel completo
        }
        
        // ========== FINANCEIRO ==========
        function carregarFinanceiro() {
            mostrarAlerta("Carregando informações financeiras...", "info");
            // Em produção, carregaria dados financeiros
        }
        
        // ========== BACKUP E SEGURANÇA ==========
        function criarBackup() {
            if (confirm('Deseja criar um backup do sistema?')) {
                mostrarAlerta("Criando backup do sistema...", "info");
                // Em produção, faria backup no Firebase
            }
        }
        
        function alterarSenha() {
            const novaSenha = prompt('Digite a nova senha:');
            if (novaSenha && novaSenha.length >= 6) {
                // Em produção, atualizaria a senha no Firebase
                mostrarAlerta("Senha alterada com sucesso!", "success");
            }
        }
        
        function gerarLogs() {
            mostrarAlerta("Gerando logs do sistema...", "info");
            // Em produção, mostraria logs do sistema
        }
        
        function restaurarBackup() {
            if (confirm('Deseja restaurar o último backup?')) {
                mostrarAlerta("Restaurando backup...", "info");
            }
        }
        
        function limparDados() {
            if (confirm('ATENÇÃO: Esta ação irá limpar todos os dados do sistema. Tem certeza?')) {
                if (confirm('CONFIRMAÇÃO FINAL: Esta ação é irreversível. Tem certeza absoluta?')) {
                    mostrarAlerta("Limpando dados do sistema...", "warning");
                }
            }
        }
        
        // ========== CARREGAMENTO INICIAL ==========
        async function carregarDadosIniciais() {
            try {
                await Promise.all([
                    carregarProdutos(),
                    carregarClientes(),
                    carregarFuncionarios(),
                    carregarVendas()
                ]);
                
                mostrarAlerta("Sistema carregado com sucesso!", "success");
                
            } catch (error) {
                console.error("Erro ao carregar dados iniciais:", error);
                mostrarAlerta("Erro ao carregar dados do sistema", "error");
            }
        }
        
        // Adicionar estilo de pulse para feedback visual
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
        
        // Expor funções para uso global
        window.mostrarSecao = mostrarSecao;
        window.abrirModal = abrirModal;
        window.fecharModal = fecharModal;
        window.adminLogout = adminLogout;
        window.imprimirComprovante = imprimirComprovante;
        window.salvarComprovante = salvarComprovante;
        window.limparCarrinho = limparCarrinho;
        window.abrirModalProduto = abrirModalProduto;
        window.abrirModalCliente = abrirModalCliente;
        window.abrirModalFuncionario = abrirModalFuncionario;
        window.togglePaymentMethod = function(element, method) {
            selecionarFormaPagamento(method);
        };
        
        // Inicializar sistema quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            if (window.currentUser) {
                initSistema();
            }
        });
    </script>
</body>
</html>